<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creative Loop Dashboard</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Mononoki:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Mononoki', 'Courier New', monospace;
            background: linear-gradient(135deg, #1e1e2e, #2d2d44);
            color: #e4e4e7;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-family: 'Orbitron', 'Arial', sans-serif;
            font-weight: 900;
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #4ecdc4;
            letter-spacing: 2px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: #4ecdc4;
            font-size: 1.2em;
        }

        /* Quote Styles */
        .quote-container {
            text-align: center;
            padding: 20px 0;
        }

        .quote-container blockquote {
            font-size: 1.1em;
            font-style: italic;
            color: #ffffff;
            margin: 0 0 15px 0;
            padding: 0 15px;
            line-height: 1.5;
            font-family: 'Mononoki', monospace;
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        .quote-container cite {
            font-size: 0.9em;
            color: #4ecdc4;
            font-weight: bold;
            font-family: 'Mononoki', monospace;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-section {
            margin-top: 15px;
        }
        
        .progress-item {
            margin-bottom: 10px;
        }
        
        .progress-item label {
            display: block;
            color: #a1a1aa;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #45b7d1;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #a1a1aa;
            margin-top: 5px;
        }
        
        .loop-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }
        
        .status-indicator {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .complete {
            background: #22c55e;
            color: white;
        }
        
        .incomplete {
            background: #ef4444;
            color: white;
        }
        
        .controls {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            font-family: 'Mononoki', 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .timeline {
            margin-top: 30px;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .timeline-date {
            min-width: 100px;
            color: #4ecdc4;
            font-weight: bold;
        }
        
        .timeline-content {
            flex: 1;
            margin-left: 20px;
        }
        
        .emoji {
            font-size: 1.5em;
            margin-right: 10px;
        }
        
        .input-forms {
            margin: 30px 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4ecdc4;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #e4e4e7;
            font-family: 'Mononoki', 'Courier New', monospace;
            backdrop-filter: blur(5px);
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #a1a1aa;
        }
        
        .file-input-group {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        
        .file-input-group input[type="text"],
        .file-input-group textarea {
            flex: 1;
        }
        
        .file-browse-btn {
            padding: 12px 20px;
            font-size: 0.9em;
            white-space: nowrap;
            margin: 0;
        }
        
        .drop-zone {
            flex: 1;
            position: relative;
            border: 2px dashed rgba(78, 205, 196, 0.3);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .drop-zone.drag-over {
            border-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.1);
        }
        
        .drop-zone textarea {
            border: none;
            background: transparent;
        }
        
        .audio-preview {
            margin-top: 10px;
        }
        
        .images-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .image-preview-item {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 1;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-preview-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-preview-item .remove-btn:hover {
            background: #ef4444;
        }
        
        .output-forms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .input-forms {
                display: block;
            }
            
            .input-forms .card {
                margin-bottom: 20px;
            }
        }

        /* Calendar Styles */
        .calendar-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: #4ecdc4;
        }
        
        .calendar-nav {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calendar-nav:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
        }
        
        .calendar-day-header {
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: #4ecdc4;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 5px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 60px;
            position: relative;
        }
        
        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .calendar-day.today {
            background: rgba(78, 205, 196, 0.2);
            border: 2px solid #4ecdc4;
        }
        
        .calendar-day.has-activities {
            background: rgba(255, 107, 107, 0.2);
        }
        
        .calendar-day.future-day {
            background: rgba(255, 255, 255, 0.01);
            color: #666;
        }
        
        .calendar-day.future-day:hover {
            background: rgba(255, 255, 255, 0.01);
            transform: none;
        }
        
        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .activity-indicators {
            display: flex;
            gap: 2px;
            flex-wrap: wrap;
        }
        
        .activity-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        
        .activity-dot.inputs { background: #4ecdc4; }
        .activity-dot.processes { background: #ff6b6b; }
        .activity-dot.outputs { background: #ffd93d; }
        
        .view-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .view-tab {
            background: none;
            border: none;
            color: #a1a1aa;
            padding: 15px 25px;
            cursor: pointer;
            font-family: 'Mononoki', 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        
        .view-tab.active {
            color: #4ecdc4;
            border-bottom-color: #4ecdc4;
        }
        
        .view-tab:hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .view-content {
            display: none;
        }
        
        .view-content.active {
            display: block;
        }

        .vst3-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .vst3-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #4ecdc4;
        }
        
        .vst3-item h4 {
            color: #4ecdc4;
            margin: 0 0 10px 0;
        }
        
        .vst3-item .edit-btn {
            float: right;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }
        
        .vst3-item .edit-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Documents View Styles */
        .documents-content {
            margin-top: 20px;
        }

        .document-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-btn {
            background: rgba(91, 50, 124, 0.8);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Mononoki', monospace;
        }

        .category-btn:hover,
        .category-btn.active {
            background: rgba(91, 50, 124, 1);
            transform: translateY(-2px);
        }

        /* Pipeline View Styles */
        .pipeline-stages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stage-column {
            background: rgba(91, 50, 124, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(91, 50, 124, 0.3);
        }

        .stage-column h4 {
            margin-top: 0;
            color: #5b327c;
            font-family: 'Mononoki', monospace;
        }

        .pipeline-item {
            background: rgba(91, 50, 124, 0.8);
            color: white;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 0.9em;
            font-family: 'Mononoki', monospace;
        }

        /* Fitness View Styles */
        .fitness-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .metric-card {
            background: rgba(91, 50, 124, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(91, 50, 124, 0.3);
            text-align: center;
        }

        .metric-card h4 {
            margin-top: 0;
            color: #5b327c;
            font-family: 'Mononoki', monospace;
        }

        .metric-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            font-family: 'Mononoki', monospace;
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        /* Roadmap View Styles */
        .roadmap-timeline {
            margin-top: 20px;
        }

        .timeline-period {
            background: rgba(91, 50, 124, 0.1);
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 4px solid #5b327c;
        }

        .timeline-period h4 {
            margin-top: 0;
            color: #5b327c;
            font-family: 'Mononoki', monospace;
        }

        .timeline-period ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .timeline-period li {
            margin: 8px 0;
            font-family: 'Mononoki', monospace;
        }

        /* Energy Vectors View Styles */
        .energy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .energy-vector {
            background: rgba(91, 50, 124, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(91, 50, 124, 0.3);
        }

        .energy-vector h4 {
            margin-top: 0;
            color: #5b327c;
            font-family: 'Mononoki', monospace;
        }

        .energy-chart,
        .flow-states,
        .mental-indicators {
            margin-top: 10px;
        }

        .time-slot,
        .flow-indicator,
        .state-track {
            background: rgba(91, 50, 124, 0.8);
            color: white;
            padding: 6px 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 0.9em;
            font-family: 'Mononoki', monospace;
        }

        /* Fasting View Styles */
        .fasting-tracker {
            margin-top: 20px;
        }

        .sun-times,
        .fasting-schedule,
        .fasting-progress,
        .fasting-benefits {
            background: rgba(91, 50, 124, 0.1);
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            border: 1px solid rgba(91, 50, 124, 0.3);
        }

        .sun-times h4,
        .fasting-schedule h4,
        .fasting-progress h4,
        .fasting-benefits h4 {
            margin-top: 0;
            color: #5b327c;
            font-family: 'Mononoki', monospace;
        }

        .sun-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .sunrise-time,
        .sunset-time {
            background: linear-gradient(45deg, #ff9500, #ffb84d);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-family: 'Mononoki', monospace;
            text-align: center;
            font-weight: bold;
        }

        .sunset-time {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
        }

        .schedule-info,
        .progress-indicator,
        .benefit-list {
            margin-top: 10px;
        }

        .fast-window,
        .eat-window {
            background: rgba(91, 50, 124, 0.8);
            color: white;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: 'Mononoki', monospace;
        }

        .eat-window {
            background: rgba(34, 139, 34, 0.8);
        }

        .current-status {
            text-align: center;
            margin-bottom: 15px;
        }

        .status-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-family: 'Mononoki', monospace;
            font-size: 1.1em;
        }

        .status-badge.fasting {
            background: rgba(220, 20, 60, 0.8);
            color: white;
        }

        .status-badge.eating {
            background: rgba(34, 139, 34, 0.8);
            color: white;
        }

        .timer-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .timer-section {
            text-align: center;
            background: rgba(91, 50, 124, 0.2);
            padding: 10px;
            border-radius: 8px;
        }

        .timer-label {
            font-size: 0.9em;
            color: white;
            font-family: 'Mononoki', monospace;
            margin-bottom: 5px;
        }

        .timer-value {
            font-size: 1.3em;
            font-weight: bold;
            font-family: 'Mononoki', monospace;
            color: #333;
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        .progress-bar-container {
            position: relative;
            margin-top: 10px;
        }

        .progress-bar {
            background: rgba(91, 50, 124, 0.2);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #5b327c, #8a4fb8);
            width: 0%;
            transition: width 1s ease;
            border-radius: 10px;
        }

        .progress-text {
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            font-weight: bold;
            color: white;
            font-family: 'Mononoki', monospace;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .benefit-item {
            background: rgba(91, 50, 124, 0.8);
            color: white;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: 'Mononoki', monospace;
            display: flex;
            justify-content: space-between;
        }

        /* Monthly Payments View Styles */
        .payments-overview {
            margin-top: 20px;
        }

        .payment-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .category-section {
            background: rgba(91, 50, 124, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(91, 50, 124, 0.3);
        }

        .category-section h4 {
            margin-top: 0;
            color: #5b327c;
            font-family: 'Mononoki', monospace;
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(91, 50, 124, 0.8);
            color: white;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: 'Mononoki', monospace;
        }

        .amount {
            font-weight: bold;
            font-size: 0.9em;
            color: #4ecdc4;
        }

        .payment-item-content {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .payment-item-actions {
            display: flex;
            gap: 5px;
            margin-left: 10px;
        }

        .payment-edit-btn,
        .payment-delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .payment-edit-btn:hover {
            background: rgba(75, 150, 255, 0.2);
        }

        .payment-delete-btn:hover {
            background: rgba(255, 75, 75, 0.2);
        }

        .payment-summary {
            text-align: center;
            background: rgba(91, 50, 124, 0.2);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #5b327c;
        }

        .payment-summary h4 {
            margin: 0;
            color: #5b327c;
            font-size: 1.3em;
            font-family: 'Mononoki', monospace;
        }

        /* Tasks View Styles */
        .task-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .task-sections {
                grid-template-columns: 1fr;
            }
        }

        .task-section {
            background: rgba(91, 50, 124, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(91, 50, 124, 0.3);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-header h4 {
            margin: 0;
            color: #5b327c;
            font-family: 'Mononoki', monospace;
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        /* Apply turquoise outline to all purple headings for better readability */
        h4[style*="color: #5b327c"], 
        .stage-column h4,
        .metric-card h4,
        .timeline-period h4,
        .energy-vector h4,
        .fasting-schedule h4,
        .fasting-progress h4,
        .fasting-benefits h4,
        .sun-times h4,
        .category-section h4,
        .payment-summary h4 {
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        .add-task-btn {
            background: rgba(91, 50, 124, 0.8);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Mononoki', monospace;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .add-task-btn:hover {
            background: rgba(91, 50, 124, 1);
            transform: translateY(-1px);
        }

        .task-list {
            min-height: 200px;
            margin-bottom: 15px;
        }

        .loading-tasks {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
            font-family: 'Mononoki', monospace;
        }

        .task-item {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 4px solid #5b327c;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            transform: translateX(3px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .task-item.high-priority {
            border-left-color: #dc143c;
        }

        .task-item.medium-priority {
            border-left-color: #ffa500;
        }

        .task-item.low-priority {
            border-left-color: #32cd32;
        }

        .task-checkbox {
            margin-right: 10px;
            cursor: pointer;
            transform: scale(1.2);
        }

        .task-text {
            flex: 1;
            font-family: 'Mononoki', monospace;
            font-size: 0.95em;
            color: #000000;
            transition: all 0.3s ease;
        }

        .task-text.completed {
            text-decoration: line-through;
            opacity: 0.8;
            color: #555;
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        .task-priority {
            margin-right: 10px;
            font-size: 0.8em;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Mononoki', monospace;
        }

        .task-priority.high {
            background: rgba(220, 20, 60, 0.2);
            color: #dc143c;
        }

        .task-priority.medium {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
        }

        .task-priority.low {
            background: rgba(50, 205, 50, 0.2);
            color: #32cd32;
        }

        .task-actions {
            display: flex;
            gap: 5px;
        }

        .task-edit-btn,
        .task-delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 3px;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .task-edit-btn {
            color: #5b327c;
        }

        .task-edit-btn:hover {
            background: rgba(91, 50, 124, 0.2);
        }

        .task-delete-btn {
            color: #dc143c;
        }

        .task-delete-btn:hover {
            background: rgba(220, 20, 60, 0.2);
        }

        .task-progress {
            border-top: 1px solid rgba(91, 50, 124, 0.3);
            padding-top: 15px;
        }

        .progress-info {
            text-align: center;
            margin-bottom: 8px;
            font-family: 'Mononoki', monospace;
            color: #5b327c;
            font-weight: bold;
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        .progress-bar-container {
            position: relative;
            margin-top: 10px;
        }

        .progress-bar {
            background: rgba(91, 50, 124, 0.2);
            height: 15px;
            border-radius: 7px;
            overflow: hidden;
            border: 2px solid #40e0d0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #5b327c, #8a4fb8);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 7px;
        }

        .progress-text {
            position: absolute;
            top: 1px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7em;
            font-weight: bold;
            color: white;
            font-family: 'Mononoki', monospace;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        /* Enhanced Image Management Styles */
        .drop-zone-content {
            padding: 40px 20px;
            text-align: center;
            color: #4ecdc4;
            font-family: 'Mononoki', monospace;
        }

        .drop-zone-content p {
            margin: 5px 0;
        }

        .image-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .image-controls .file-input-group {
            margin: 0;
        }

        .image-counter {
            text-align: center;
            margin: 10px 0;
            font-family: 'Mononoki', monospace;
        }

        .image-item {
            position: relative;
            background: rgba(91, 50, 124, 0.1);
            border: 1px solid rgba(91, 50, 124, 0.3);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .image-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .image-item img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            display: block;
        }

        .image-item-controls {
            position: absolute;
            top: 2px;
            right: 2px;
            display: flex;
            gap: 2px;
        }

        .image-remove-btn {
            background: rgba(220, 20, 60, 0.8);
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .image-remove-btn:hover {
            background: rgba(220, 20, 60, 1);
            transform: scale(1.1);
        }

        .image-item-name {
            padding: 5px;
            font-size: 0.7em;
            color: #5b327c;
            font-family: 'Mononoki', monospace;
            text-align: center;
            background: rgba(255, 255, 255, 0.8);
            word-break: break-all;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #1a1a1a;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .close {
            color: #999;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4ecdc4;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-family: 'Mononoki', 'Courier New', monospace;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }

        /* Fix dropdown option visibility */
        .form-group select option {
            background-color: #2d3748;
            color: #ffffff;
            padding: 8px;
        }

        .form-group select option:hover,
        .form-group select option:checked {
            background-color: #4ecdc4;
            color: #1a202c;
        }

        /* Specific styles for all select elements */
        select {
            background-color: rgba(255, 255, 255, 0.05) !important;
            color: white !important;
        }

        select option {
            background-color: #2d3748 !important;
            color: #ffffff !important;
            padding: 8px !important;
        }

        select option:hover,
        select option:checked,
        select option:focus {
            background-color: #4ecdc4 !important;
            color: #1a202c !important;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .form-actions button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Mononoki', 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .form-actions button[type="submit"] {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
        }

        .form-actions button[type="submit"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .form-actions button[type="button"] {
            background: #6b7280;
            color: white;
        }

        .form-actions button[type="button"]:hover {
            background: #4b5563;
        }

        /* Enhanced VST3 Styles */
        .vst3-header-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            gap: 20px;
        }
        
        .vst3-header-section > div {
            flex: 1;
        }
        
        .vst3-controls {
            margin-bottom: 25px;
            text-align: center;
        }

        .add-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Mononoki', 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .vst3-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .vst3-header h4 {
            margin: 0;
            color: #4ecdc4;
            font-size: 1.2em;
        }

        .tags {
            margin-top: 12px;
            font-size: 13px;
            color: #a1a1aa;
        }

        .file-path {
            margin-top: 12px;
            font-size: 12px;
            color: #6b7280;
            font-family: 'Courier New', monospace;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 5px;
        }

        #categoryGroup {
            display: block;
        }

        .form-group input[type="text"]:invalid,
        .form-group select:invalid {
            border-color: #ef4444;
        }

        /* Historical Data Display Styles */
        .stage-content.completed {
            background: rgba(64, 224, 208, 0.15);
            border: 1px solid rgba(64, 224, 208, 0.4);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .stage-content.completed .stage-icon {
            color: #40e0d0;
            font-size: 2em;
            text-shadow: 0 0 10px rgba(64, 224, 208, 0.5);
        }

        .stage-content.completed .stage-info h5 {
            color: #40e0d0;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 
                -1px -1px 0 #5b327c,
                1px -1px 0 #5b327c,
                -1px 1px 0 #5b327c,
                1px 1px 0 #5b327c;
        }

        .stage-content.completed .stage-info p {
            color: #ffffff;
            margin: 5px 0;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .stage-content.completed .stage-info p strong {
            color: #40e0d0;
            font-weight: bold;
        }

        .stage-content:not(.completed) {
            background: rgba(91, 50, 124, 0.1);
            border: 1px solid rgba(91, 50, 124, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .stage-content:not(.completed) .stage-icon {
            color: #888;
            font-size: 2em;
        }

        .stage-content:not(.completed) .stage-info h5 {
            color: #888;
            margin-bottom: 10px;
        }

        .stage-content:not(.completed) .stage-info p {
            color: #aaa;
            margin: 5px 0;
            font-size: 0.9em;
            font-style: italic;
        }

        /* Date Navigation Styles */
        .date-navigation {
            background: rgba(91, 50, 124, 0.1);
            border: 1px solid rgba(91, 50, 124, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            font-family: 'Mononoki', monospace;
        }

        @media (max-width: 768px) {
            .date-navigation {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .date-nav-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .date-nav-section h4 {
            color: #5b327c;
            margin: 0 0 15px 0;
            font-size: 1.1em;
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        .date-picker-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .date-input {
            padding: 8px 12px;
            border: 2px solid rgba(64, 224, 208, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-family: 'Mononoki', monospace;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .date-input:focus {
            outline: none;
            border-color: #40e0d0;
            box-shadow: 0 0 10px rgba(64, 224, 208, 0.3);
        }

        .recent-days {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .recent-day-btn {
            padding: 8px 15px;
            background: rgba(64, 224, 208, 0.1);
            border: 1px solid rgba(64, 224, 208, 0.3);
            border-radius: 6px;
            color: #40e0d0;
            font-family: 'Mononoki', monospace;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .recent-day-btn:hover {
            background: rgba(64, 224, 208, 0.2);
            border-color: #40e0d0;
            transform: translateY(-2px);
        }

        .recent-day-btn.has-data {
            border-left: 4px solid #40e0d0;
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .nav-btn {
            padding: 10px 15px;
            background: rgba(91, 50, 124, 0.3);
            border: 1px solid rgba(91, 50, 124, 0.5);
            border-radius: 8px;
            color: #ffffff;
            font-family: 'Mononoki', monospace;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(91, 50, 124, 0.5);
            border-color: #5b327c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .nav-btn:active {
            transform: translateY(0);
        }

        /* Date Navigation Toggle */
        .date-nav-toggle {
            background: rgba(91, 50, 124, 0.2);
            border: 1px solid rgba(91, 50, 124, 0.4);
            border-radius: 10px;
            padding: 12px 20px;
            margin: 10px 0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #5b327c;
            font-family: 'Mononoki', monospace;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .date-nav-toggle:hover {
            background: rgba(91, 50, 124, 0.3);
            border-color: #5b327c;
            transform: translateY(-2px);
        }

        .date-nav-toggle span:first-child {
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        #date-nav-arrow {
            transition: transform 0.3s ease;
            color: #40e0d0;
            font-size: 1.2em;
        }

        #date-nav-arrow.expanded {
            transform: rotate(180deg);
        }

        .current-date-display {
            margin-top: 10px;
            padding: 8px;
            background: rgba(64, 224, 208, 0.1);
            border-radius: 6px;
            font-size: 0.8em;
            color: #40e0d0;
            text-align: center;
        }

        #today-display {
            font-weight: bold;
            color: #ffffff;
        }

        /* Daily Summary Styles */
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(91, 50, 124, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(91, 50, 124, 0.3);
        }

        .summary-date-info h2 {
            color: #5b327c;
            margin: 0;
            font-family: 'Mononoki', monospace;
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        .summary-date-info p {
            color: #ffffff;
            margin: 5px 0 0 0;
            font-family: 'Mononoki', monospace;
            opacity: 0.8;
        }

        .summary-controls {
            display: flex;
            gap: 10px;
        }

        .summary-btn {
            padding: 10px 20px;
            background: rgba(64, 224, 208, 0.2);
            border: 1px solid rgba(64, 224, 208, 0.4);
            border-radius: 8px;
            color: #40e0d0;
            font-family: 'Mononoki', monospace;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .summary-btn:hover {
            background: rgba(64, 224, 208, 0.3);
            border-color: #40e0d0;
            transform: translateY(-2px);
        }

        .summary-placeholder {
            text-align: center;
            padding: 60px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 2px dashed rgba(91, 50, 124, 0.3);
        }

        .placeholder-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .summary-placeholder h3 {
            color: #5b327c;
            margin-bottom: 15px;
            font-family: 'Mononoki', monospace;
        }

        .summary-placeholder p {
            color: #ffffff;
            margin-bottom: 30px;
            opacity: 0.8;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .summary-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(91, 50, 124, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(91, 50, 124, 0.3);
            color: #ffffff;
            font-family: 'Mononoki', monospace;
            font-size: 0.9em;
        }

        .feature-icon {
            font-size: 1.5em;
            color: #40e0d0;
        }

        /* Daily Summary Content Styles */
        .daily-summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .daily-summary-grid {
                grid-template-columns: 1fr;
            }
            .summary-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }

        .summary-section {
            background: rgba(91, 50, 124, 0.1);
            border: 1px solid rgba(91, 50, 124, 0.3);
            border-radius: 12px;
            padding: 20px;
        }

        .summary-section h3 {
            color: #5b327c;
            margin: 0 0 15px 0;
            font-family: 'Mononoki', monospace;
            text-shadow: 
                -1px -1px 0 #40e0d0,
                1px -1px 0 #40e0d0,
                -1px 1px 0 #40e0d0,
                1px 1px 0 #40e0d0;
        }

        .file-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .gallery-item {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .gallery-item:hover {
            transform: scale(1.05);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item audio {
            width: 100%;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(64, 224, 208, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(64, 224, 208, 0.3);
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #40e0d0;
            display: block;
        }

        .stat-label {
            color: #ffffff;
            font-size: 0.8em;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* Activity and Achievement Styles */
        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid transparent;
        }

        .activity-item.completed {
            border-left-color: #40e0d0;
            background: rgba(64, 224, 208, 0.1);
        }

        .activity-icon {
            font-size: 1.8em;
            color: #40e0d0;
        }

        .activity-details {
            flex: 1;
        }

        .activity-details strong {
            color: #40e0d0;
            display: block;
            margin-bottom: 5px;
        }

        .activity-details p {
            color: #ffffff;
            margin: 2px 0;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .achievement-item {
            padding: 10px 15px;
            margin: 8px 0;
            background: rgba(64, 224, 208, 0.1);
            border: 1px solid rgba(64, 224, 208, 0.3);
            border-radius: 6px;
            color: #ffffff;
            font-family: 'Mononoki', monospace;
            font-size: 0.9em;
        }

        /* Document Editor Styles */
        #document-editor {
            margin-top: 20px;
        }

        #document-editor h4 {
            margin-bottom: 15px;
            color: #4ecdc4;
            font-family: 'Mononoki', monospace;
        }

        #document-selector {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-family: 'Mononoki', monospace;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        #document-content {
            width: 100%;
            height: 300px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-family: 'Mononoki', monospace;
            font-size: 0.9em;
            margin-bottom: 15px;
            resize: none;
        }

        /* Override default button styles for document editor */
        #document-editor button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Mononoki', 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        #document-editor button:hover {
            transform: translateY(-2px);
        }

        /* Specific styles for save and delete buttons */
        #document-editor button[onclick="saveDocument()"] {
            background: linear-gradient(45deg, #22c55e, #16a34a);
            color: white;
        }

        #document-editor button[onclick="deleteDocument()"] {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CREATIVE LOOP</h1>
            <p>Track your creative consistency and momentum</p>
            <button id="return-to-today" class="btn" style="display: none; margin-top: 10px;" onclick="returnToToday()"> Return to Today</button>
        </div>

        <!-- Add a section to display the current date -->
        <div id="current-date" style="font-weight: bold; margin-bottom: 10px;"></div>

        <!-- Date Navigation Toggle -->
        <div class="date-nav-toggle" onclick="toggleDateNavigation()">
            <span> Date Navigation</span>
            <span id="date-nav-arrow"></span>
        </div>

        <!-- Date Navigation Bar -->
        <div class="date-navigation" id="date-navigation" style="display: none;">
            <div class="date-nav-section">
                <h4> Quick Jump</h4>
                <div class="date-picker-container">
                    <input type="date" id="date-picker" class="date-input" onchange="jumpToDate(this.value)">
                    <button class="nav-btn" onclick="showDatePicker()"> Pick Date</button>
                    <div class="current-date-display" id="current-date-display">
                        Today: <span id="today-display"></span>
                    </div>
                </div>
            </div>
            
            <div class="date-nav-section">
                <h4> Recent Days</h4>
                <div class="recent-days" id="recent-days">
                    <!-- Recent days will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="date-nav-section">
                <h4> Quick Actions</h4>
                <div class="quick-actions">
                    <button class="nav-btn" onclick="jumpToDate('yesterday')">Yesterday</button>
                    <button class="nav-btn" onclick="jumpToDate('today')">Today</button>
                    <button class="nav-btn" onclick="jumpToWeekStart()">Week Start</button>
                    <button class="nav-btn" onclick="jumpToMonthStart()">Month Start</button>
                </div>
            </div>
        </div>

        <!-- View Tabs -->
        <div class="view-tabs">
            <button class="view-tab active" data-view="dashboard"> Dashboard</button>
            <button class="view-tab" data-view="daily-summary"> Daily Summary</button>
            <button class="view-tab" data-view="calendar"> Calendar</button>
            <button class="view-tab" data-view="vst3"> VST3 Plugins</button>
            <button class="view-tab" data-view="documents"> Documents</button>
            <button class="view-tab" data-view="pipeline"> Pipeline</button>
            <button class="view-tab" data-view="fitness"> Fitness</button>
            <button class="view-tab" data-view="roadmap"> Roadmap</button>
            <button class="view-tab" data-view="energy"> Energy Vectors</button>
            <button class="view-tab" data-view="fasting"> Fasting</button>
            <button class="view-tab" data-view="payments"> Monthly Payments</button>
            <button class="view-tab" data-view="tasks"> Tasks</button>
        </div>

        <!-- Dashboard View -->
        <div class="view-content active" id="dashboard-view">
        <div class="dashboard-grid">
            <!-- Daily Input Status -->
            <div class="card">
                <h3> Today's Input Loop</h3>
                <div class="loop-status">
                    <span>Sonic Sketch (30 min Music Jam)</span>
                    <span class="status-indicator incomplete" id="sketch-status"></span>
                </div>
                <div class="loop-status">
                    <span>Visual Moodboard (5 images)</span>
                    <span class="status-indicator incomplete" id="visual-status"></span>
                </div>
                <div class="loop-status">
                    <span>Lore/Study Fragment</span>
                    <span class="status-indicator incomplete" id="lore-status"></span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="daily-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="daily-progress-text">0%</div>
                </div>
                <p id="daily-status-text">Daily loop incomplete</p>
                <div style="margin-top: 15px; text-align: center;">
                    <button class="btn" onclick="toggleInputForms()" style="font-size: 0.9em; padding: 8px 16px;">
                         Edit Inputs
                    </button>
                </div>
            </div>
            
            <!-- Daily Inspiration -->
            <div class="card">
                <h3> Daily Inspiration</h3>
                <div class="quote-container">
                    <blockquote id="motivational-quote">
                        "The way to get started is to quit talking and begin doing."
                    </blockquote>
                    <cite id="quote-author"> Walt Disney</cite>
                </div>
                <div style="margin-top: 15px; text-align: center;">
                    <button class="btn" onclick="getNewQuote()" style="background: #4ecdc4; font-size: 0.9em; padding: 8px 16px;">
                         New Quote
                    </button>
                </div>
            </div>
            
            <!-- Weekly Progress -->
            <div class="card">
                <h3> Weekly Progress</h3>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="weekly-micro">0</div>
                        <div class="stat-label">Micro Releases</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">1</div>
                        <div class="stat-label">Target</div>
                    </div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="weekly-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="weekly-progress-percentage">0%</div>
                </div>
                <p id="weekly-status-text">Behind weekly target</p>
            </div>
            
            <!-- Monthly Progress -->
            <div class="card">
                <h3> Monthly Progress</h3>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="monthly-major">0</div>
                        <div class="stat-label">Major Releases</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">1</div>
                        <div class="stat-label">Target</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="monthly-vst3">0</div>
                        <div class="stat-label">VST3 Plugins</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Target (1/week)</div>
                    </div>
                </div>
                <div class="progress-section">
                    <div class="progress-item">
                        <label>Major Releases:</label>
                        <div class="progress-bar-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="monthly-major-progress" style="width: 0%"></div>
                            </div>
                            <div class="progress-text" id="monthly-major-progress-text">0%</div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <label>VST3 Plugins:</label>
                        <div class="progress-bar-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="monthly-vst3-progress" style="width: 0%"></div>
                            </div>
                            <div class="progress-text" id="monthly-vst3-progress-text">0%</div>
                        </div>
                    </div>
                </div>
                <p id="monthly-status-text">Behind monthly targets</p>
            </div>
            
            <!-- Creative Stats -->
            <div class="card">
                <h3> Creative Statistics</h3>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="streak-count">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="completion-rate">0%</div>
                        <div class="stat-label">Completion Rate</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="total-processes">0</div>
                        <div class="stat-label">Processes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="total-outputs">0</div>
                        <div class="stat-label">Total Outputs</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Input Forms -->
        <div class="input-forms" id="input-forms" style="display: none;">
            <div style="text-align: right; margin-bottom: 20px;">
                <button class="btn" onclick="toggleInputForms()" style="background: #ef4444;"> Close Forms</button>
            </div>
            <div class="card">
                <h3> Edit Sonic Sketch</h3>
                <form id="sketch-form">
                    <div class="form-group">
                        <label>Duration (minutes):</label>
                        <input type="number" id="sketch-duration" value="30" min="1" max="120">
                    </div>
                    <div class="form-group">
                        <label>Description:</label>
                        <textarea id="sketch-description" placeholder="Describe your sonic sketch..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Audio File (optional):</label>
                        <div class="file-input-group">
                            <input type="file" id="sketch-audio-file" accept="audio/*" style="display: none;">
                            <input type="text" id="sketch-audio" placeholder="path/to/audio.wav" readonly>
                            <button type="button" class="btn file-browse-btn" onclick="document.getElementById('sketch-audio-file').click()">
                                 Browse
                            </button>
                        </div>
                        <div id="sketch-audio-preview" class="audio-preview" style="display: none;">
                            <audio controls style="width: 100%; margin-top: 10px;"></audio>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Tags (comma-separated):</label>
                        <input type="text" id="sketch-tags" placeholder="ambient, experimental, field-recording">
                    </div>
                    <button type="submit" class="btn"> Save Sonic Sketch</button>
                </form>
            </div>
            
            <div class="card">
                <h3> Edit Visual Moodboard</h3>
                <form id="visual-form">
                    <div class="form-group">
                        <label>Theme:</label>
                        <input type="text" id="visual-theme" placeholder="Cyberpunk neon aesthetics">
                    </div>
                    <div class="form-group">
                        <label>Images (5 recommended for complete moodboard):</label>
                        
                        <!-- Image Management Controls -->
                        <div class="image-controls">
                            <div class="file-input-group">
                                <input type="file" id="visual-images-file-bulk" accept="image/*" multiple style="display: none;">
                                <button type="button" class="btn file-browse-btn" onclick="document.getElementById('visual-images-file-bulk').click()">
                                     Browse Multiple Images
                                </button>
                            </div>
                            
                            <div class="file-input-group">
                                <input type="file" id="visual-images-file-single" accept="image/*" style="display: none;">
                                <button type="button" class="btn file-browse-btn" onclick="document.getElementById('visual-images-file-single').click()">
                                     Add Single Image
                                </button>
                            </div>
                            
                            <button type="button" class="btn file-browse-btn" onclick="openImagesFolder()">
                                 Open Images Folder
                            </button>
                        </div>

                        <!-- Drop Zone -->
                        <div class="drop-zone" id="image-drop-zone">
                            <div class="drop-zone-content">
                                <p> Drag & drop images here</p>
                                <p><small>or use the buttons above</small></p>
                            </div>
                        </div>
                        
                        <!-- Image Counter -->
                        <div class="image-counter" id="image-counter">
                            <small style="color: #4ecdc4; font-weight: bold;">
                                <span id="image-count">0</span> images selected
                            </small>
                        </div>
                        
                        <!-- Images Preview with Individual Controls -->
                        <div id="visual-images-preview" class="images-preview">
                            <!-- Individual images will be displayed here -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Color Palette (comma-separated):</label>
                        <input type="text" id="visual-colors" placeholder="#ff00ff, #00ffff, #ffff00">
                    </div>
                    <button type="submit" class="btn"> Save Visual Moodboard</button>
                </form>
            </div>
            
            <div class="card">
                <h3> Edit Lore Fragment</h3>
                <form id="lore-form">
                    <div class="form-group">
                        <label>Character:</label>
                        <input type="text" id="lore-character" placeholder="Character name">
                    </div>
                    <div class="form-group">
                        <label>Fragment:</label>
                        <textarea id="lore-fragment" placeholder="Describe the lore fragment..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Narrative Arc:</label>
                        <input type="text" id="lore-arc" placeholder="Digital archaeology arc">
                    </div>
                    <div class="form-group">
                        <label>World Building Elements (comma-separated):</label>
                        <input type="text" id="lore-elements" placeholder="data ghosts, forgotten networks, encrypted memories">
                    </div>
                    <button type="submit" class="btn"> Save Lore Fragment</button>
                </form>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="controls">
            <button class="btn" onclick="toggleInputForms()"> Edit Today's Inputs</button>
            <button class="btn" onclick="quickLogProcess()"> Log Process</button>
            <button class="btn" onclick="quickLogOutput()"> Log Output</button>
            <button class="btn" onclick="refreshData()"> Refresh Data</button>
        </div>
        
        <!-- Recent Activity Timeline -->
        <div class="timeline">
            <h3> Recent Activity</h3>
            <div id="timeline-content">
                <div class="timeline-item">
                    <span class="emoji"></span>
                    <div class="timeline-date">Today</div>
                    <div class="timeline-content">
                        Welcome to your Creative Loop Dashboard! Start by logging your daily inputs.
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- Daily Summary View -->
        <div class="view-content" id="daily-summary-view">
            <div class="summary-header">
                <div class="summary-date-info">
                    <h2 id="summary-date-title"> Daily Summary</h2>
                    <p id="summary-date-subtitle">Select a date to view detailed summary</p>
                </div>
                <div class="summary-controls">
                    <button class="summary-btn" onclick="generateDailyReport()"> Generate Report</button>
                    <button class="summary-btn" onclick="exportDayData()"> Export Data</button>
                </div>
            </div>

            <div class="summary-content" id="summary-content">
                <!-- Summary content will be loaded dynamically -->
                <div class="summary-placeholder">
                    <div class="placeholder-icon"></div>
                    <h3>Welcome to Daily Summary</h3>
                    <p>Use the Date Navigation above or click on a calendar date to view a comprehensive daily summary.</p>
                    <div class="summary-features">
                        <div class="feature-item">
                            <span class="feature-icon"></span>
                            <span>Creative Activities Overview</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon"></span>
                            <span>File Gallery & Media</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon"></span>
                            <span>Progress Metrics & Stats</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon"></span>
                            <span>Task Completion Analysis</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon"></span>
                            <span>Daily Insights & Comparisons</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar View -->
        <div class="view-content" id="calendar-view">
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="calendar-nav" id="prev-month"></button>
                    <h2 id="calendar-title">October 2025</h2>
                    <button class="calendar-nav" id="next-month"></button>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- Calendar will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- VST3 Plugins View -->
        <div class="view-content" id="vst3-view">
            <div class="card">
                <div class="vst3-header-section">
                    <div>
                        <h3> VST3 Plugin Development</h3>
                        <p>Track your VST3 plugin development progress (1 per week, 4 per month)</p>
                    </div>
                    <button class="add-btn" onclick="openVST3Modal()">+ Add New VST3 Plugin</button>
                </div>
                
                <div class="vst3-list" id="vst3-list">
                    <!-- VST3 plugins will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Documents View -->
        <div class="view-content" id="documents-view">
            <div class="card">
                <h3> Documents</h3>
                <p>Manage your creative documentation, lyrics, ideas, and project notes</p>
                
                <!-- Document Editor -->
                <div id="document-editor">
                    <h4>Document Editor</h4>
                    <div class="form-group">
                        <label for="document-selector">Select Document:</label>
                        <select id="document-selector" onchange="onDocumentSelect()">
                            <option value="">-- Select Document --</option>
                            <option value="Manifesto1.txt">Manifesto1.txt</option>
                            <option value="Manifesto2.txt">Manifesto2.txt</option>
                            <option value="Manifesto3.txt">Manifesto3.txt</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="file-name">File Name:</label>
                        <input type="text" id="file-name" placeholder="Enter document name">
                    </div>
                    <div class="form-group">
                        <label for="document-content">Content:</label>
                        <textarea id="document-content" rows="20" placeholder="Write your document content here..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button onclick="newDocument()" class="btn"> New</button>
                        <button onclick="saveDocument()" class="btn"> Save</button>
                        <button onclick="deleteDocument()" class="btn delete-btn"> Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pipeline View -->
        <div class="view-content" id="pipeline-view">
            <div class="card">
                <h3> Pipeline</h3>
                <p>Track your creative workflow and production pipeline</p>
                <div class="pipeline-stages">
                    <div class="stage-column">
                        <h4> Intake</h4>
                        <div class="stage-items">
                            <div class="pipeline-item">Sonic Sketches</div>
                            <div class="pipeline-item">Visual Ideas</div>
                        </div>
                    </div>
                    <div class="stage-column">
                        <h4> Process</h4>
                        <div class="stage-items">
                            <div class="pipeline-item">Sample Processing</div>
                            <div class="pipeline-item">Remix Development</div>
                        </div>
                    </div>
                    <div class="stage-column">
                        <h4> Output</h4>
                        <div class="stage-items">
                            <div class="pipeline-item">Micro Releases</div>
                            <div class="pipeline-item">Major Releases</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fitness View -->
        <div class="view-content" id="fitness-view">
            <div class="card">
                <h3> Fitness</h3>
                <p>Track your physical health and energy levels to maintain creative momentum</p>
                <div class="fitness-metrics">
                    <div class="metric-card">
                        <h4> Cardio</h4>
                        <div class="metric-value">0 sessions this week</div>
                    </div>
                    <div class="metric-card">
                        <h4> Strength</h4>
                        <div class="metric-value">0 sessions this week</div>
                    </div>
                    <div class="metric-card">
                        <h4> Flexibility</h4>
                        <div class="metric-value">0 sessions this week</div>
                    </div>
                    <div class="metric-card">
                        <h4> Energy Level</h4>
                        <div class="metric-value">Track daily</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Roadmap View -->
        <div class="view-content" id="roadmap-view">
            <div class="card">
                <h3> Roadmap</h3>
                <p>Plan your creative journey and track long-term goals</p>
                <div class="roadmap-timeline">
                    <div class="timeline-period">
                        <h4> This Month</h4>
                        <ul>
                            <li>4 VST3 Plugins (1 per week)</li>
                            <li>1 Major Release</li>
                            <li>Consistent Daily Loop</li>
                        </ul>
                    </div>
                    <div class="timeline-period">
                        <h4> Next 3 Months</h4>
                        <ul>
                            <li>Complete Audio Plugin Suite</li>
                            <li>Launch Creative Brand</li>
                            <li>Build Fan Community</li>
                        </ul>
                    </div>
                    <div class="timeline-period">
                        <h4> This Year</h4>
                        <ul>
                            <li>Professional Studio Setup</li>
                            <li>Live Performance Debut</li>
                            <li>Collaborative Projects</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Energy Vectors View -->
        <div class="view-content" id="energy-view">
            <div class="card">
                <h3> Energy Vectors</h3>
                <p>Monitor and optimize your creative energy flows</p>
                <div class="energy-grid">
                    <div class="energy-vector">
                        <h4> Circadian Rhythm</h4>
                        <div class="energy-chart">
                            <div class="time-slot morning">Morning: High</div>
                            <div class="time-slot afternoon">Afternoon: Medium</div>
                            <div class="time-slot evening">Evening: Low</div>
                        </div>
                    </div>
                    <div class="energy-vector">
                        <h4> Creative Flow</h4>
                        <div class="flow-states">
                            <div class="flow-indicator">Deep Work: 25min blocks</div>
                            <div class="flow-indicator">Break: 5min recharge</div>
                        </div>
                    </div>
                    <div class="energy-vector">
                        <h4> Mental State</h4>
                        <div class="mental-indicators">
                            <div class="state-track">Focus: Track daily</div>
                            <div class="state-track">Creativity: Track daily</div>
                            <div class="state-track">Motivation: Track daily</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fasting View -->
        <div class="view-content" id="fasting-view">
            <div class="card">
                <h3> Fasting</h3>
                <p>Track intermittent fasting for enhanced focus and creative clarity</p>
                <div class="fasting-tracker">
                    <div class="sun-times">
                        <h4> Today's Sun Schedule</h4>
                        <div class="sun-info">
                            <div class="sunrise-time"> Sunrise: <span id="sunrise-time">--:--</span></div>
                            <div class="sunset-time"> Sunset: <span id="sunset-time">--:--</span></div>
                        </div>
                    </div>
                    <div class="fasting-schedule">
                        <h4> Today's Fasting Schedule</h4>
                        <div class="schedule-info">
                            <div class="fast-window"> Fasting: <span id="fast-start">--:--</span> - <span id="fast-end">--:--</span> (16 hours)</div>
                            <div class="eat-window"> Eating: <span id="eat-start">--:--</span> - <span id="eat-end">--:--</span> (8 hours)</div>
                        </div>
                    </div>
                    <div class="fasting-progress">
                        <h4> Live Progress</h4>
                        <div class="progress-indicator">
                            <div class="current-status">
                                <div class="status-badge" id="current-status">Calculating...</div>
                            </div>
                            <div class="timer-display">
                                <div class="timer-section">
                                    <div class="timer-label">Current Duration:</div>
                                    <div class="timer-value" id="current-duration">00:00:00</div>
                                </div>
                                <div class="timer-section">
                                    <div class="timer-label">Time Remaining:</div>
                                    <div class="timer-value" id="time-remaining">00:00:00</div>
                                </div>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                </div>
                                <div class="progress-text" id="progress-percentage">0%</div>
                            </div>
                        </div>
                    </div>
                    <div class="fasting-benefits">
                        <h4> Benefits Tracking</h4>
                        <div class="benefit-list">
                            <div class="benefit-item">Mental Clarity: <span id="clarity-level">Track daily</span></div>
                            <div class="benefit-item">Energy Stability: <span id="energy-level">Track daily</span></div>
                            <div class="benefit-item">Creative Focus: <span id="focus-level">Track daily</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monthly Payments View -->
        <div class="view-content" id="payments-view">
            <div class="card">
                <h3> Monthly Payments</h3>
                <p>Track recurring expenses for your creative business and lifestyle</p>
                
                <!-- Add Payment Button -->
                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="showAddPaymentModal()" style="background: #4ecdc4;">
                         Add Payment
                    </button>
                </div>
                
                <div class="payments-overview">
                    <div class="payment-categories" id="payment-categories">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                    <div class="payment-summary">
                        <div class="total-expenses">
                            <h4 id="payment-total"> Monthly Total: $0</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks View -->
        <div class="view-content" id="tasks-view">
            <div class="card">
                <h3> Tasks</h3>
                <p>Manage your weekly and monthly to-do lists with progress tracking</p>
                
                <div class="task-sections">
                    <!-- Weekly Tasks -->
                    <div class="task-section">
                        <div class="task-header">
                            <h4> Weekly Tasks</h4>
                            <button class="add-task-btn" onclick="showAddTaskModal('weekly')">+ Add Task</button>
                        </div>
                        <div class="task-list" id="weekly-tasks">
                            <div class="loading-tasks">Loading weekly tasks...</div>
                        </div>
                        <div class="task-progress">
                            <div class="progress-info">
                                <span id="weekly-completed">0</span> / <span id="weekly-total">0</span> completed
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="weekly-progress-fill"></div>
                                </div>
                                <div class="progress-text" id="weekly-progress-text">0%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Tasks -->
                    <div class="task-section">
                        <div class="task-header">
                            <h4> Monthly Tasks</h4>
                            <button class="add-task-btn" onclick="showAddTaskModal('monthly')">+ Add Task</button>
                        </div>
                        <div class="task-list" id="monthly-tasks">
                            <div class="loading-tasks">Loading monthly tasks...</div>
                        </div>
                        <div class="task-progress">
                            <div class="progress-info">
                                <span id="monthly-completed">0</span> / <span id="monthly-total">0</span> completed
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="monthly-progress-fill"></div>
                                </div>
                                <div class="progress-text" id="monthly-progress-text">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Task Modal -->
        <div id="addTaskModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('addTaskModal').style.display='none'">&times;</span>
                <h2 id="add-task-title">Add New Task</h2>
                <form id="addTaskForm">
                    <div class="form-group">
                        <label for="taskText">Task:</label>
                        <input type="text" id="taskText" name="text" required placeholder="Enter task description...">
                    </div>
                    
                    <div class="form-group">
                        <label for="taskPriority">Priority:</label>
                        <select id="taskPriority" name="priority">
                            <option value="low"> Low</option>
                            <option value="medium" selected> Medium</option>
                            <option value="high"> High</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="document.getElementById('addTaskModal').style.display='none'">Cancel</button>
                        <button type="submit">Add Task</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Task Modal -->
        <div id="editTaskModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('editTaskModal').style.display='none'">&times;</span>
                <h2>Edit Task</h2>
                <form id="editTaskForm">
                    <div class="form-group">
                        <label for="editTaskText">Task:</label>
                        <input type="text" id="editTaskText" name="text" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editTaskPriority">Priority:</label>
                        <select id="editTaskPriority" name="priority">
                            <option value="low"> Low</option>
                            <option value="medium"> Medium</option>
                            <option value="high"> High</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="document.getElementById('editTaskModal').style.display='none'">Cancel</button>
                        <button type="submit">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Payment Modal -->
        <div id="paymentModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('paymentModal').style.display='none'">&times;</span>
                <h2 id="paymentModalTitle">Add Payment</h2>
                <form id="paymentForm">
                    <div class="form-group">
                        <label for="paymentName">Payment Name:</label>
                        <input type="text" id="paymentName" name="name" required placeholder="e.g., Ableton Live Suite">
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentAmount">Amount (monthly):</label>
                        <input type="number" id="paymentAmount" name="amount" step="0.01" min="0" required placeholder="e.g., 20.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentCategory">Category:</label>
                        <select id="paymentCategory" name="category" required>
                            <option value="">Select Category</option>
                            <option value="creative"> Creative Tools</option>
                            <option value="services"> Online Services</option>
                            <option value="lifestyle"> Lifestyle</option>
                            <option value="business"> Business</option>
                            <option value="other"> Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentNotes">Notes (optional):</label>
                        <textarea id="paymentNotes" name="notes" placeholder="Additional details..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="document.getElementById('paymentModal').style.display='none'">Cancel</button>
                        <button type="submit">Save Payment</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Mock data for demonstration - in real implementation, this would fetch from your Python agent
        let mockData = {
            daily: { sonic_sketch_complete: false, visual_moodboard_complete: false, lore_fragment_complete: false },
            weekly: { micro_releases_this_week: 0, vst3_plugins_this_week: 0, weekly_goal_met: false },
            monthly: { major_releases_this_month: 0, vst3_plugins_this_month: 0, monthly_goal_met: false },
            stats: { current_streak: 0, completion_rate: 0, total_processes: 0, total_micro_releases: 0, total_major_releases: 0, total_vst3_plugins: 0 }
        };
        
        function updateDashboard() {
            // Update daily status
            const dailyComplete = mockData.daily.sonic_sketch_complete + mockData.daily.visual_moodboard_complete + mockData.daily.lore_fragment_complete;
            const dailyProgress = (dailyComplete / 3) * 100;
            
            document.getElementById('sketch-status').textContent = mockData.daily.sonic_sketch_complete ? '' : '';
            document.getElementById('sketch-status').className = mockData.daily.sonic_sketch_complete ? 'status-indicator complete' : 'status-indicator incomplete';
            
            document.getElementById('visual-status').textContent = mockData.daily.visual_moodboard_complete ? '' : '';
            document.getElementById('visual-status').className = mockData.daily.visual_moodboard_complete ? 'status-indicator complete' : 'status-indicator incomplete';
            
            document.getElementById('lore-status').textContent = mockData.daily.lore_fragment_complete ? '' : '';
            document.getElementById('lore-status').className = mockData.daily.lore_fragment_complete ? 'status-indicator complete' : 'status-indicator incomplete';
            
            document.getElementById('daily-progress').style.width = dailyProgress + '%';
            document.getElementById('daily-progress-text').textContent = Math.round(dailyProgress) + '%';
            document.getElementById('daily-status-text').textContent = dailyProgress === 100 ? ' Daily loop complete!' : `${dailyComplete}/3 inputs complete`;
            
            // Update weekly progress
            const weeklyProgress = Math.min(mockData.weekly.micro_releases_this_week * 100, 100);
            document.getElementById('weekly-micro').textContent = mockData.weekly.micro_releases_this_week;
            document.getElementById('weekly-progress').style.width = weeklyProgress + '%';
            document.getElementById('weekly-progress-percentage').textContent = Math.round(weeklyProgress) + '%';
            document.getElementById('weekly-status-text').textContent = mockData.weekly.weekly_goal_met ? ' Weekly goal achieved!' : ' Behind weekly target';
            
            // Update monthly progress
            const monthlyMajorProgress = Math.min(mockData.monthly.major_releases_this_month * 100, 100);
            const monthlyVst3Progress = Math.min((mockData.monthly.vst3_plugins_this_month || 0) / 4 * 100, 100);
            
            document.getElementById('monthly-major').textContent = mockData.monthly.major_releases_this_month;
            document.getElementById('monthly-vst3').textContent = mockData.monthly.vst3_plugins_this_month || 0;
            document.getElementById('monthly-major-progress').style.width = monthlyMajorProgress + '%';
            document.getElementById('monthly-major-progress-text').textContent = Math.round(monthlyMajorProgress) + '%';
            document.getElementById('monthly-vst3-progress').style.width = monthlyVst3Progress + '%';
            document.getElementById('monthly-vst3-progress-text').textContent = Math.round(monthlyVst3Progress) + '%';
            document.getElementById('monthly-status-text').textContent = mockData.monthly.monthly_goal_met ? ' Monthly goals achieved!' : ' Behind monthly targets';
            
            // Update stats
            document.getElementById('streak-count').textContent = mockData.stats.current_streak;
            document.getElementById('completion-rate').textContent = mockData.stats.completion_rate.toFixed(1) + '%';
            document.getElementById('total-processes').textContent = mockData.stats.total_processes;
            document.getElementById('total-outputs').textContent = mockData.stats.total_micro_releases + mockData.stats.total_major_releases + (mockData.stats.total_vst3_plugins || 0);
        }
        
        function toggleInputForms() {
            const formsDiv = document.getElementById('input-forms');
            if (formsDiv.style.display === 'none') {
                formsDiv.style.display = 'block';
                loadExistingInputs();
            } else {
                formsDiv.style.display = 'none';
            }
        }
        
        function loadExistingInputs() {
            fetch('/api/input/today')
                .then(response => response.json())
                .then(data => {
                    // Load sonic sketch data
                    if (data.sonic_sketch) {
                        document.getElementById('sketch-duration').value = data.sonic_sketch.duration_minutes || 30;
                        document.getElementById('sketch-description').value = data.sonic_sketch.description || '';
                        document.getElementById('sketch-audio').value = data.sonic_sketch.audio_file || '';
                        document.getElementById('sketch-tags').value = (data.sonic_sketch.tags || []).join(', ');
                        
                        // Show audio preview if there's an existing audio file
                        if (data.sonic_sketch.audio_file) {
                            showExistingAudioPreview(data.sonic_sketch.audio_file);
                        }
                    }
                    
                    // Load visual moodboard data
                    if (data.visual_moodboard) {
                        document.getElementById('visual-theme').value = data.visual_moodboard.theme || '';
                        document.getElementById('visual-colors').value = (data.visual_moodboard.color_palette || []).join(', ');
                        
                        // Display saved images
                        if (data.visual_moodboard.images && data.visual_moodboard.images.length > 0) {
                            displaySavedImages(data.visual_moodboard.images);
                        }
                    }
                    
                    // Load lore fragment data
                    if (data.lore_fragment) {
                        document.getElementById('lore-character').value = data.lore_fragment.character || '';
                        document.getElementById('lore-fragment').value = data.lore_fragment.fragment || '';
                        document.getElementById('lore-arc').value = data.lore_fragment.narrative_arc || '';
                        document.getElementById('lore-elements').value = (data.lore_fragment.world_building_elements || []).join(', ');
                    }
                })
                .catch(error => {
                    console.log('Could not load existing data:', error);
                    // Forms will remain empty for new inputs
                });
        }
        
        // File handling functions
        let selectedImages = [];
        let savedImages = []; // Track images that are already saved on the server
        
        function setupFileHandlers() {
            // Audio file handler
            document.getElementById('sketch-audio-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const audioPath = file.name; // In real app, this would be the full path
                    document.getElementById('sketch-audio').value = audioPath;
                    
                    // Show audio preview and keep it visible
                    const previewDiv = document.getElementById('sketch-audio-preview');
                    const audio = previewDiv.querySelector('audio');
                    audio.src = URL.createObjectURL(file);
                    previewDiv.style.display = 'block';
                    
                    // Add a clear button if it doesn't exist
                    if (!previewDiv.querySelector('.clear-audio-btn')) {
                        const clearBtn = document.createElement('button');
                        clearBtn.className = 'btn clear-audio-btn';
                        clearBtn.innerHTML = ' Clear Audio';
                        clearBtn.type = 'button';
                        clearBtn.style.marginTop = '5px';
                        clearBtn.onclick = function() {
                            document.getElementById('sketch-audio').value = '';
                            document.getElementById('sketch-audio-file').value = '';
                            previewDiv.style.display = 'none';
                            this.remove();
                        };
                        previewDiv.appendChild(clearBtn);
                    }
                }
            });
            
            // Enhanced image file handlers
            document.getElementById('visual-images-file-bulk').addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                handleImageFiles(files, true); // true for bulk mode
            });
            
            document.getElementById('visual-images-file-single').addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                handleImageFiles(files, false); // false for single mode
            });
            
            // Drag and drop handlers
            const dropZone = document.getElementById('image-drop-zone');
            
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                
                const files = Array.from(e.dataTransfer.files).filter(file => 
                    file.type.startsWith('image/')
                );
                
                if (files.length > 0) {
                    handleImageFiles(files);
                }
            });
        }
        
        function showImagePreviews(files) {
            const previewDiv = document.getElementById('visual-images-preview');
            previewDiv.innerHTML = '';
            
            if (files.length === 0) {
                previewDiv.style.display = 'none';
                return;
            }
            
            previewDiv.style.display = 'grid';
            
            files.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'image-item';
                
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.alt = file.name;
                img.title = file.name;
                
                const controls = document.createElement('div');
                controls.className = 'image-item-controls';
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'image-remove-btn';
                removeBtn.innerHTML = '';
                removeBtn.title = 'Remove image';
                removeBtn.onclick = () => removeImage(index);
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'image-item-name';
                nameDiv.textContent = file.name.length > 15 ? file.name.substring(0, 12) + '...' : file.name;
                nameDiv.title = file.name;
                
                controls.appendChild(removeBtn);
                item.appendChild(img);
                item.appendChild(controls);
                item.appendChild(nameDiv);
                previewDiv.appendChild(item);
            });
        }
        
        function showCombinedImagePreviews() {
            const previewDiv = document.getElementById('visual-images-preview');
            previewDiv.innerHTML = '';
            
            const totalImages = savedImages.length + selectedImages.length;
            if (totalImages === 0) {
                previewDiv.style.display = 'none';
                return;
            }
            
            previewDiv.style.display = 'grid';
            
            // Show saved images first
            savedImages.forEach((filename, index) => {
                const item = document.createElement('div');
                item.className = 'image-item';
                
                const img = document.createElement('img');
                img.src = `/api/images/${filename}`;
                img.alt = filename;
                img.title = filename;
                
                const controls = document.createElement('div');
                controls.className = 'image-item-controls';
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'image-remove-btn';
                removeBtn.innerHTML = '';
                removeBtn.title = 'Remove saved image';
                removeBtn.onclick = () => removeSavedImage(index);
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'image-item-name';
                nameDiv.textContent = filename.length > 15 ? filename.substring(0, 12) + '...' : filename;
                nameDiv.title = filename;
                nameDiv.style.color = '#4ecdc4'; // Different color for saved images
                
                controls.appendChild(removeBtn);
                item.appendChild(img);
                item.appendChild(controls);
                item.appendChild(nameDiv);
                previewDiv.appendChild(item);
            });
            
            // Show newly selected images
            selectedImages.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'image-item';
                
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.alt = file.name;
                img.title = file.name;
                
                const controls = document.createElement('div');
                controls.className = 'image-item-controls';
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'image-remove-btn';
                removeBtn.innerHTML = '';
                removeBtn.title = 'Remove new image';
                removeBtn.onclick = () => removeNewImage(index);
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'image-item-name';
                nameDiv.textContent = file.name.length > 15 ? file.name.substring(0, 12) + '...' : file.name;
                nameDiv.title = file.name;
                
                controls.appendChild(removeBtn);
                item.appendChild(img);
                item.appendChild(controls);
                item.appendChild(nameDiv);
                previewDiv.appendChild(item);
            });
        }
        
        function removeSavedImage(index) {
            savedImages.splice(index, 1);
            updateImageCounter(savedImages.length + selectedImages.length);
            showCombinedImagePreviews();
        }
        
        function removeNewImage(index) {
            selectedImages.splice(index, 1);
            updateImageCounter(savedImages.length + selectedImages.length);
            showCombinedImagePreviews();
        }
        
        function removeImage(index) {
            selectedImages.splice(index, 1);
            updateImageCounter(selectedImages.length);
            showImagePreviews(selectedImages);
            
            // Clear file inputs when no images remain
            if (selectedImages.length === 0) {
                document.getElementById('visual-images-file-bulk').value = '';
                document.getElementById('visual-images-file-single').value = '';
            }
            
            showSuccessMessage(` Image removed`);
        }
        
        function clearAudioPreview() {
            // Only hide if no audio file is currently selected
            const audioInput = document.getElementById('sketch-audio');
            if (!audioInput.value.trim()) {
                document.getElementById('sketch-audio-preview').style.display = 'none';
                document.getElementById('sketch-audio-file').value = '';
            }
        }
        
        function showExistingAudioPreview(audioFilename) {
            const previewDiv = document.getElementById('sketch-audio-preview');
            const audio = previewDiv.querySelector('audio');
            
            // Set audio source to the server endpoint for the saved file
            audio.src = `/api/audio/${audioFilename}`;
            previewDiv.style.display = 'block';
            
            // Add clear button if it doesn't exist
            if (!previewDiv.querySelector('.clear-audio-btn')) {
                const clearBtn = document.createElement('button');
                clearBtn.className = 'btn clear-audio-btn';
                clearBtn.textContent = 'Remove Audio';
                clearBtn.style.marginTop = '10px';
                clearBtn.type = 'button';
                clearBtn.onclick = function() {
                    document.getElementById('sketch-audio').value = '';
                    previewDiv.style.display = 'none';
                    clearBtn.remove();
                };
                previewDiv.appendChild(clearBtn);
            }
        }
        
        function clearImagePreviews() {
            selectedImages = [];
            updateImageCounter(savedImages.length);
            showCombinedImagePreviews();
        }
        
        function clearAllImagePreviews() {
            selectedImages = [];
            savedImages = [];
            updateImageCounter(0);
            document.getElementById('visual-images-preview').style.display = 'none';
            document.getElementById('visual-images-file-bulk').value = '';
            document.getElementById('visual-images-file-single').value = '';
        }
        
        function handleImageFiles(files, isBulkMode = true) {
            if (isBulkMode && savedImages.length === 0) {
                // Replace all images in bulk mode only if no saved images exist
                selectedImages = Array.from(files);
            } else {
                // Add new images to existing selection (preserving saved images)
                selectedImages = selectedImages.concat(Array.from(files));
            }
            
            // Update counter (total of saved + newly selected images)
            updateImageCounter(savedImages.length + selectedImages.length);
            
            // Show combined previews (saved + newly selected)
            showCombinedImagePreviews();
            
            // Show success message
            if (files.length > 0) {
                const mode = (isBulkMode && savedImages.length === 0) ? 'selected' : 'added';
                showSuccessMessage(` ${files.length} image${files.length > 1 ? 's' : ''} ${mode}`);
            }
        }
        
        function updateImageCounter(count) {
            const countSpan = document.getElementById('image-count');
            
            if (countSpan) {
                countSpan.textContent = count;
            }
            
            // Legacy support for old counter if it exists
            const counter = document.getElementById('image-counter');
            if (counter) {
                const counterText = counter.querySelector('small');
                if (counterText && !countSpan) {
                    let message = `${count} image${count > 1 ? 's' : ''} selected`;
                    
                    if (count === 5) {
                        message += '  Perfect for moodboard!';
                        counterText.style.color = '#22c55e';
                    } else if (count < 5 && count > 0) {
                        message += ` (${5 - count} more recommended)`;
                        counterText.style.color = '#f59e0b';
                    } else if (count > 5) {
                        message += ' (more than recommended)';
                        counterText.style.color = '#4ecdc4';
                    }
                    
                    counterText.textContent = message;
                }
            }
        }
        
        function displaySavedImages(imageFilenames) {
            const previewDiv = document.getElementById('visual-images-preview');
            previewDiv.innerHTML = ''; // Clear existing previews
            
            // Store saved images for reference
            savedImages = [...imageFilenames];
            
            imageFilenames.forEach(filename => {
                const imageContainer = document.createElement('div');
                imageContainer.className = 'image-preview-item';
                imageContainer.style.cssText = `
                    display: inline-block;
                    margin: 5px;
                    position: relative;
                    border: 2px solid #4ecdc4;
                    border-radius: 8px;
                    overflow: hidden;
                `;
                
                const img = document.createElement('img');
                img.src = `/api/images/${filename}`;
                img.style.cssText = `
                    width: 100px;
                    height: 100px;
                    object-fit: cover;
                    display: block;
                `;
                img.alt = filename;
                
                const removeBtn = document.createElement('button');
                removeBtn.innerHTML = '';
                removeBtn.className = 'remove-image-btn';
                removeBtn.style.cssText = `
                    position: absolute;
                    top: 2px;
                    right: 2px;
                    background: rgba(255, 255, 255, 0.9);
                    border: none;
                    border-radius: 50%;
                    width: 20px;
                    height: 20px;
                    cursor: pointer;
                    font-size: 12px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                
                removeBtn.onclick = function() {
                    // Remove the image from display (this doesn't delete from server, just removes from current selection)
                    imageContainer.remove();
                    updateImageCounter(previewDiv.children.length);
                };
                
                imageContainer.appendChild(img);
                imageContainer.appendChild(removeBtn);
                previewDiv.appendChild(imageContainer);
            });
            
            if (imageFilenames.length > 0) {
                previewDiv.style.display = 'block';
                updateImageCounter(imageFilenames.length);
            }
        }
        
        // Form submission handlers
        document.addEventListener('DOMContentLoaded', function() {
            setupFileHandlers();
            document.getElementById('sketch-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Create FormData to handle file uploads properly
                const formData = new FormData();
                formData.append('duration', document.getElementById('sketch-duration').value);
                formData.append('description', document.getElementById('sketch-description').value);
                const tagsValue = document.getElementById('sketch-tags').value.split(',').map(t => t.trim()).filter(t => t).join(',');
                formData.append('tags', tagsValue);
                // include the selected date so server updates the correct day's entry
                formData.append('date', selectedDate);
                
                // Add audio file if selected
                const audioFileInput = document.getElementById('sketch-audio-file');
                if (audioFileInput.files.length > 0) {
                    formData.append('audio_file', audioFileInput.files[0]);
                } else {
                    // If no new file, but there's an existing audio value, keep it
                    const existingAudio = document.getElementById('sketch-audio').value;
                    if (existingAudio) {
                        formData.append('existing_audio', existingAudio);
                    }
                }
                
                fetch('/api/input/sketch', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        mockData.daily.sonic_sketch_complete = true;
                        updateDashboard();
                        addTimelineItem('', `Sonic sketch updated: ${data.description}`);
                        showSuccessMessage(' Sonic sketch saved successfully!');
                        
                        // Preserve audio file and player state
                        const audioFile = document.getElementById('sketch-audio').value;
                        const audioPreviewVisible = document.getElementById('sketch-audio-preview').style.display === 'block';
                        
                        document.getElementById('sketch-form').reset();
                        
                        // Restore audio file info if it was there
                        if (audioFile) {
                            document.getElementById('sketch-audio').value = audioFile;
                            if (audioPreviewVisible) {
                                document.getElementById('sketch-audio-preview').style.display = 'block';
                            }
                        }
                        
                        refreshData();
                    }
                })
                .catch(error => {
                    // Fallback for demo mode
                    mockData.daily.sonic_sketch_complete = true;
                    updateDashboard();
                    addTimelineItem('', `Sonic sketch logged: ${data.description}`);
                });
            });
            
            document.getElementById('visual-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Create FormData to handle file uploads properly
                const formData = new FormData();
                formData.append('theme', document.getElementById('visual-theme').value);
                formData.append('color_palette', document.getElementById('visual-colors').value);
                
                // Add information about images to keep from server
                if (savedImages.length > 0) {
                    formData.append('existing_images', JSON.stringify(savedImages));
                }
                
                // Add new selected image files to FormData
                if (selectedImages.length > 0) {
                    selectedImages.forEach((file, index) => {
                        formData.append(`images`, file);
                    });
                } else if (savedImages.length === 0) {
                    formData.append('images', '');
                }
                
                fetch('/api/input/visual', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        mockData.daily.visual_moodboard_complete = true;
                        updateDashboard();
                        addTimelineItem('', `Visual moodboard updated: ${data.theme}`);
                        showSuccessMessage(' Visual moodboard saved successfully!');
                        document.getElementById('visual-form').reset();
                        clearAllImagePreviews();
                        refreshData();
                    }
                })
                .catch(error => {
                    // Fallback for demo mode
                    mockData.daily.visual_moodboard_complete = true;
                    updateDashboard();
                    addTimelineItem('', `Visual moodboard logged: ${data.theme}`);
                });
            });
            
            document.getElementById('lore-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const data = {
                    character: document.getElementById('lore-character').value,
                    fragment: document.getElementById('lore-fragment').value,
                    narrative_arc: document.getElementById('lore-arc').value,
                    world_building_elements: document.getElementById('lore-elements').value.split(',').map(e => e.trim()).filter(e => e)
                };
                
                fetch('/api/input/lore', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        mockData.daily.lore_fragment_complete = true;
                        updateDashboard();
                        addTimelineItem('', `Lore fragment updated for ${data.character}: ${data.fragment}`);
                        showSuccessMessage(' Lore fragment saved successfully!');
                        document.getElementById('lore-form').reset();
                        refreshData();
                    }
                })
                .catch(error => {
                    // Fallback for demo mode
                    mockData.daily.lore_fragment_complete = true;
                    updateDashboard();
                    addTimelineItem('', `Lore fragment logged for ${data.character}: ${data.fragment}`);
                });
            });
        });
        
        function quickLogProcess() {
            const sample = prompt('Sample source:');
            const remix = prompt('Remix approach:');
            const render = prompt('Render format:');
            const emotion = prompt('Emotion tag:');
            if (sample && remix && render && emotion) {
                const data = {
                    sample_source: sample,
                    remix_approach: remix,
                    render_format: render,
                    emotion_tag: emotion
                };
                
                fetch('/api/process', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        addTimelineItem('', `Process logged: ${sample}  ${remix}  ${render} (${emotion})`);
                    }
                })
                .catch(error => {
                    addTimelineItem('', `Process logged: ${sample}  ${remix}  ${render} (${emotion})`);
                });
            }
        }
        
        function quickLogOutput() {
            const type = prompt('Output type (micro/major/vst3):');
            const title = prompt('Title:');
            
            let endpoint, data;
            if (type === 'vst3') {
                endpoint = '/api/output/vst3';
                data = { title };
            } else {
                const category = prompt('Category (beat/visual/lore/track/video/plugin):');
                endpoint = type === 'major' ? '/api/output/major' : '/api/output/micro';
                data = { title, category };
            }
            
            if (type && title && (type === 'vst3' || data.category)) {
                fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        if (type === 'major') {
                            mockData.monthly.major_releases_this_month++;
                            mockData.monthly.monthly_goal_met = mockData.monthly.major_releases_this_month >= 1 && mockData.monthly.vst3_plugins_this_month >= 4;
                        } else if (type === 'vst3') {
                            mockData.weekly.vst3_plugins_this_week++;
                            mockData.monthly.vst3_plugins_this_month++;
                            mockData.weekly.weekly_goal_met = mockData.weekly.micro_releases_this_week >= 1 && mockData.weekly.vst3_plugins_this_week >= 1;
                            mockData.monthly.monthly_goal_met = mockData.monthly.major_releases_this_month >= 1 && mockData.monthly.vst3_plugins_this_month >= 4;
                        } else {
                            mockData.weekly.micro_releases_this_week++;
                            mockData.weekly.weekly_goal_met = mockData.weekly.micro_releases_this_week >= 1 && mockData.weekly.vst3_plugins_this_week >= 1;
                        }
                        updateDashboard();
                        addTimelineItem('', `${type === 'major' ? 'Major' : 'Micro'} release logged: ${title}`);
                        showSuccessMessage(`${type === 'major' ? 'Major' : type === 'vst3' ? 'VST3' : 'Micro'} release saved!`);
                    }
                })
                .catch(error => {
                    console.error('Error logging output:', error);
                    showSuccessMessage('Output logged locally (server unavailable)');
                });
            }
        }

        // Calendar Functionality
    let currentDate = new Date();
    // Currently selected date for editing/viewing (YYYY-MM-DD)
    let selectedDate = new Date().toISOString().split('T')[0];
        
        function loadCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            
            document.getElementById('calendar-title').textContent = 
                new Date(year, month - 1).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            fetch(`/api/calendar/${year}/${month}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        renderCalendar(year, month, data.calendar);
                    }
                })
                .catch(error => {
                    console.log('Calendar data not available, showing empty calendar');
                    renderCalendar(year, month, {});
                });
        }
        
        function renderCalendar(year, month, calendarData) {
            const grid = document.getElementById('calendar-grid');
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            grid.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // Add empty cells for days before month starts
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                grid.appendChild(emptyDay);
            }
            
            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const today = new Date();
                const currentDay = new Date(year, month - 1, day);
                const isFuture = currentDay > today;
                const isToday = year === today.getFullYear() && month === today.getMonth() + 1 && day === today.getDate();
                
                if (isToday) {
                    dayElement.classList.add('today');
                }
                
                if (isFuture) {
                    dayElement.classList.add('future-day');
                }
                
                const dayKey = String(day).padStart(2, '0');
                const dayData = calendarData[dayKey] || {};
                
                if (Object.keys(dayData).length > 0) {
                    dayElement.classList.add('has-activities');
                }
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'calendar-day-number';
                dayNumber.textContent = day;
                dayElement.appendChild(dayNumber);
                
                // Add activity indicators
                const indicators = document.createElement('div');
                indicators.className = 'activity-indicators';
                
                Object.keys(dayData).forEach(activityType => {
                    const dot = document.createElement('div');
                    dot.className = `activity-dot ${activityType}`;
                    indicators.appendChild(dot);
                });
                
                dayElement.appendChild(indicators);
                
                // Add click handler (only for past/present days)
                if (!isFuture) {
                    dayElement.addEventListener('click', () => {
                        loadDayInDashboard(year, month, day, dayData);
                    });
                    dayElement.style.cursor = 'pointer';
                } else {
                    dayElement.style.cursor = 'not-allowed';
                    dayElement.style.opacity = '0.5';
                }
                
                grid.appendChild(dayElement);
            }
        }
        
        // Calendar navigation
        document.getElementById('prev-month').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            loadCalendar();
        });
        
        document.getElementById('next-month').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            loadCalendar();
        });
        
        function loadDayInDashboard(year, month, day, dayData) {
            const date = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            // track which date is currently selected so edit forms post to the right day
            selectedDate = date;
            const dateObj = new Date(year, month - 1, day);
            const isToday = dateObj.toDateString() === new Date().toDateString();
            
            // If not today, switch to Daily Summary view instead of dashboard
            if (isToday) {
                showView('dashboard');
            
                // Update dashboard title to show selected date
                const dashboardTitle = document.querySelector('.header h1');
                dashboardTitle.innerHTML = ' DSGNRG CREATIVE LOOP';
                document.getElementById('return-to-today').style.display = 'none';
                
                // Load real-time data for today
                loadDayData(date, dayData, isToday);
            } else {
                // Switch to Daily Summary view for past/future dates
                showView('daily-summary');
                
                // Update header title
                const dashboardTitle = document.querySelector('.header h1');
                // Fixed encoding issue on line below
                // dashboardTitle.innerHTML = ` CREATIVE LOOP - ${dateObj.toLocaleDateString()}`;
                dashboardTitle.innerHTML = ` CREATIVE LOOP - ${dateObj.toLocaleDateString()}`;
                
                // Show return button
                document.getElementById('return-to-today').style.display = 'inline-block';
                
                // Load Daily Summary for selected date  
                loadDailySummary(date);
            }
        }
        
        function loadDayData(date, dayData, isToday) {
            // If it's today, load real-time data
            if (isToday) {
                refreshData();
                return;
            }
            
            // For historical days, fetch detailed data from the API
            fetch(`/api/calendar/${date.split('-')[0]}/${parseInt(date.split('-')[1])}/${parseInt(date.split('-')[2])}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadHistoricalDashboard(data.data, date);
                    } else {
                        console.log('No data available for', date);
                        loadEmptyDashboard(date);
                    }
                })
                .catch(error => {
                    console.error('Error loading day data:', error);
                    loadEmptyDashboard(date);
                });
        }
        
        function loadHistoricalDashboard(dayData, date) {
            // Update dashboard with historical data
            const inputData = dayData.input_data || {};
            
            // Update sonic sketch section
            const sonicSection = document.querySelector('.stage-column:nth-child(1)');
            if (inputData.sonic_sketch) {
                sonicSection.innerHTML = `
                    <h4> Sonic Sketch</h4>
                    <div class="stage-content completed">
                        <div class="stage-icon"></div>
                        <div class="stage-info">
                            <h5>Completed on ${new Date(date).toLocaleDateString()}</h5>
                            <p><strong>Duration:</strong> ${inputData.sonic_sketch.duration || 'N/A'} minutes</p>
                            <p><strong>Description:</strong> ${inputData.sonic_sketch.description || 'No description'}</p>
                            ${inputData.sonic_sketch.audio_file ? `<p><strong>Audio File:</strong> ${inputData.sonic_sketch.audio_file}</p>` : ''}
                        </div>
                    </div>
                `;
            } else {
                sonicSection.innerHTML = `
                    <h4> Sonic Sketch</h4>
                    <div class="stage-content">
                        <div class="stage-icon"></div>
                        <div class="stage-info">
                            <h5>Not completed on ${new Date(date).toLocaleDateString()}</h5>
                            <p>No sonic sketch recorded for this date</p>
                        </div>
                    </div>
                `;
            }
            
            // Update visual moodboard section
            const visualSection = document.querySelector('.stage-column:nth-child(2)');
            if (inputData.visual_moodboard) {
                const images = inputData.visual_moodboard.images || [];
                const imageCount = Array.isArray(images) ? images.length : 0;
                visualSection.innerHTML = `
                    <h4> Visual Moodboard</h4>
                    <div class="stage-content completed">
                        <div class="stage-icon"></div>
                        <div class="stage-info">
                            <h5>Completed on ${new Date(date).toLocaleDateString()}</h5>
                            <p><strong>Images:</strong> ${imageCount} uploaded</p>
                            <p><strong>Description:</strong> ${inputData.visual_moodboard.description || 'No description'}</p>
                        </div>
                    </div>
                `;
            } else {
                visualSection.innerHTML = `
                    <h4> Visual Moodboard</h4>
                    <div class="stage-content">
                        <div class="stage-icon"></div>
                        <div class="stage-info">
                            <h5>Not completed on ${new Date(date).toLocaleDateString()}</h5>
                            <p>No visual moodboard created for this date</p>
                        </div>
                    </div>
                `;
            }
            
            // Update lore fragment section
            const loreSection = document.querySelector('.stage-column:nth-child(3)');
            if (inputData.lore_fragment) {
                loreSection.innerHTML = `
                    <h4> Lore Fragment</h4>
                    <div class="stage-content completed">
                        <div class="stage-icon"></div>
                        <div class="stage-info">
                            <h5>Completed on ${new Date(date).toLocaleDateString()}</h5>
                            <p><strong>Fragment:</strong> "${inputData.lore_fragment.content || 'No content'}"</p>
                            <p><strong>Tags:</strong> ${(inputData.lore_fragment.tags || []).join(', ') || 'None'}</p>
                        </div>
                    </div>
                `;
            } else {
                loreSection.innerHTML = `
                    <h4> Lore Fragment</h4>
                    <div class="stage-content">
                        <div class="stage-icon"></div>
                        <div class="stage-info">
                            <h5>Not completed on ${new Date(date).toLocaleDateString()}</h5>
                            <p>No lore fragment written for this date</p>
                        </div>
                    </div>
                `;
            }
            
            // Show historical data message
            showSuccessMessage(` Loaded data for ${new Date(date).toLocaleDateString()}`);
        }
        
        function loadEmptyDashboard(date) {
            // Clear all sections for empty day
            const sections = document.querySelectorAll('.stage-column');
            sections.forEach((section, index) => {
                const titles = [' Sonic Sketch', ' Visual Moodboard', ' Lore Fragment'];
                section.innerHTML = `
                    <h4>${titles[index]}</h4>
                    <div class="stage-content">
                        <div class="stage-icon"></div>
                        <div class="stage-info">
                            <h5>No activity on ${new Date(date).toLocaleDateString()}</h5>
                            <p>No data recorded for this date</p>
                        </div>
                    </div>
                `;
            });
            showSuccessMessage(` No data found for ${new Date(date).toLocaleDateString()}`);
        }
        
        function returnToToday() {
            const today = new Date();
            const todayKey = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            // Reset title and hide button
            document.querySelector('.header h1').innerHTML = ' DSGNRG CREATIVE LOOP';
            document.getElementById('return-to-today').style.display = 'none';
            
            // Load today's data
            refreshData();
        }

        // Date Navigation Functions
        function jumpToDate(dateValue) {
            let targetDate;
            
            if (dateValue === 'today') {
                targetDate = new Date();
            } else if (dateValue === 'yesterday') {
                targetDate = new Date();
                targetDate.setDate(targetDate.getDate() - 1);
            } else if (dateValue) {
                targetDate = new Date(dateValue);
            } else {
                return;
            }
            
            const year = targetDate.getFullYear();
            const month = targetDate.getMonth() + 1;
            const day = targetDate.getDate();
            
            // Load the day data (similar to calendar click)
            loadDayInDashboard(year, month, day, {});
            
            // If we're currently in Daily Summary view, also update it
            const currentView = document.querySelector('.view-content.active');
            if (currentView && currentView.id === 'daily-summary-view') {
                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                loadDailySummary(dateStr);
            }
        }

        function jumpToWeekStart() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - dayOfWeek); // Go to Sunday
            
            jumpToDate(weekStart.toISOString().split('T')[0]);
        }

        function jumpToMonthStart() {
            const today = new Date();
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            
            jumpToDate(monthStart.toISOString().split('T')[0]);
        }

        function showDatePicker() {
            const datePicker = document.getElementById('date-picker');
            datePicker.showPicker ? datePicker.showPicker() : datePicker.focus();
        }

        function loadRecentDays() {
            const recentDaysContainer = document.getElementById('recent-days');
            const today = new Date();
            const recentDays = [];
            
            // Generate last 7 days
            for (let i = 1; i <= 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                recentDays.push({
                    date: date,
                    dateString: date.toISOString().split('T')[0],
                    displayName: i === 1 ? 'Yesterday' : date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })
                });
            }
            
            // Create buttons for recent days
            recentDaysContainer.innerHTML = recentDays.map(day => `
                <button class="recent-day-btn" onclick="jumpToDate('${day.dateString}')">
                    ${day.displayName}
                </button>
            `).join('');
            
            // Check which days have data and mark them
            checkDaysForData(recentDays);
        }

        function checkDaysForData(days) {
            days.forEach(day => {
                const year = day.date.getFullYear();
                const month = day.date.getMonth() + 1;
                const dayNum = day.date.getDate();
                
                fetch(`/api/calendar/${year}/${month}/${dayNum}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success && (data.data.calendar_data && Object.keys(data.data.calendar_data).length > 0 || 
                            data.data.input_data && Object.keys(data.data.input_data).length > 0)) {
                            // This day has data - mark the button
                            const button = document.querySelector(`button[onclick="jumpToDate('${day.dateString}')"]`);
                            if (button) {
                                button.classList.add('has-data');
                            }
                        }
                    })
                    .catch(error => {
                        // Ignore errors for days without data
                    });
            });
        }

        function initializeDateNavigation() {
            // Set today's date in the date picker
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            document.getElementById('date-picker').value = todayString;
            
            // Update today's display
            const todayDisplay = document.getElementById('today-display');
            todayDisplay.textContent = today.toLocaleDateString('en-US', { 
                weekday: 'long',
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Load recent days
            loadRecentDays();
        }

        // Document Management Functions
        function onDocumentSelect() {
            const selector = document.getElementById('document-selector');
            const selectedFile = selector.value;
            
            if (selectedFile) {
                // Update the file name input
                document.getElementById('file-name').value = selectedFile.replace('.txt', '');
                // Load the document content
                loadDocument(selectedFile);
            }
        }

        function newDocument() {
            const fileNameInput = document.getElementById('file-name');
            const documentEditor = document.getElementById('document-content');
            const selector = document.getElementById('document-selector');
            
            // Clear the input field and editor
            fileNameInput.value = '';
            documentEditor.value = '';
            selector.value = '';
            
            // Focus on the file name input
            fileNameInput.focus();
            
            console.log('New document created');
        }

        function saveDocument() {
            const fileName = document.getElementById('file-name').value.trim();
            const content = document.getElementById('document-content').value;
            
            if (!fileName) {
                alert('Please enter a file name');
                return;
            }
            
            // Add .txt extension if not present
            const fullFileName = fileName.endsWith('.txt') ? fileName : fileName + '.txt';
            
            // Send to server to save
            fetch('/api/save_document', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    filename: fullFileName,
                    content: content
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Document saved successfully!');
                    loadDocumentList(); // Refresh the document list
                    // Update the dropdown selection
                    const fullFileName = fileName.endsWith('.txt') ? fileName : fileName + '.txt';
                    document.getElementById('document-selector').value = fullFileName;
                } else {
                    alert('Error saving document: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error saving document:', error);
                alert('Error saving document: ' + error.message);
            });
        }

        function deleteDocument() {
            const fileName = document.getElementById('file-name').value.trim();
            
            if (!fileName) {
                alert('Please enter a file name to delete');
                return;
            }
            
            if (!confirm('Are you sure you want to delete "' + fileName + '"?')) {
                return;
            }
            
            // Add .txt extension if not present
            const fullFileName = fileName.endsWith('.txt') ? fileName : fileName + '.txt';
            
            // Send to server to delete
            fetch('/api/delete_document', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    filename: fullFileName
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Document deleted successfully!');
                    // Clear the editor
                    document.getElementById('file-name').value = '';
                    document.getElementById('document-content').value = '';
                    document.getElementById('document-selector').value = '';
                    loadDocumentList(); // Refresh the document list
                } else {
                    alert('Error deleting document: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error deleting document:', error);
                alert('Error deleting document: ' + error.message);
            });
        }

        function loadDocumentList() {
            // Fetch available documents from server
            fetch('/api/list_documents')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Available documents:', data.documents);
                        // Update the dropdown with available documents
                        const selector = document.getElementById('document-selector');
                        // Clear existing options except the first one
                        selector.innerHTML = '<option value="">-- Select Document --</option>';
                        
                        // Add documents from server
                        if (data.documents && data.documents.length > 0) {
                            data.documents.forEach(doc => {
                                const option = document.createElement('option');
                                option.value = doc;
                                option.textContent = doc;
                                selector.appendChild(option);
                            });
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading document list:', error);
                });
        }

        function loadDocument(filename) {
            // Load a specific document
            fetch('/api/load_document', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    filename: filename
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('file-name').value = filename.replace('.txt', '');
                    document.getElementById('document-content').value = data.content;
                } else {
                    alert('Error loading document: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error loading document:', error);
                alert('Error loading document: ' + error.message);
            });
        }

        function toggleDateNavigation() {
            const dateNav = document.getElementById('date-navigation');
            const arrow = document.getElementById('date-nav-arrow');
            
            if (dateNav.style.display === 'none') {
                dateNav.style.display = 'grid';
                arrow.classList.add('expanded');
                arrow.textContent = '';
            } else {
                dateNav.style.display = 'none';
                arrow.classList.remove('expanded');
                arrow.textContent = '';
            }
        }

        function showDayDetails(year, month, day, dayData) {
            // This function is kept for backward compatibility but now redirects to loadDayInDashboard
            loadDayInDashboard(year, month, day, dayData);
        }

        // Daily Summary Functions
        function loadDailySummary(date) {
            const [year, month, day] = date.split('-');
            const dateObj = new Date(year, parseInt(month) - 1, parseInt(day));
            const isToday = dateObj.toDateString() === new Date().toDateString();
            
            // Update summary header
            document.getElementById('summary-date-title').textContent = 
                ` Daily Summary - ${dateObj.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`;
            document.getElementById('summary-date-subtitle').textContent = 
                isToday ? 'Today\'s Activities & Progress' : `Historical data for ${dateObj.toLocaleDateString()}`;
            
            // Fetch detailed day data
            fetch(`/api/calendar/${year}/${parseInt(month)}/${parseInt(day)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        renderDailySummary(data.data, date);
                    } else {
                        renderEmptySummary(date);
                    }
                })
                .catch(error => {
                    console.error('Error loading daily summary:', error);
                    renderEmptySummary(date);
                });
        }

        function renderDailySummary(dayData, date) {
            const summaryContent = document.getElementById('summary-content');
            const inputData = dayData.input_data || {};
            const calendarData = dayData.calendar_data || {};
            
            summaryContent.innerHTML = `
                <div class="daily-summary-grid">
                    <div class="summary-section">
                        <h3> Creative Activities</h3>
                        <div class="activity-summary">
                            ${renderActivitySummary(inputData)}
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <h3> Daily Statistics</h3>
                        <div class="stats-grid">
                            ${renderDailyStats(inputData, calendarData)}
                        </div>
                    </div>
                </div>
                
                <div class="summary-section">
                    <h3> Media Gallery</h3>
                    <div class="file-gallery" id="summary-gallery">
                        ${renderFileGallery(inputData, date)}
                    </div>
                </div>
                
                <div class="daily-summary-grid">
                    <div class="summary-section">
                        <h3> Task Progress</h3>
                        <div id="task-summary">
                            ${renderTaskSummary(date)}
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <h3> Achievements</h3>
                        <div id="achievements-summary">
                            ${renderAchievements(inputData, calendarData)}
                        </div>
                    </div>
                </div>
            `;
            
            // Load task data for this date
            loadTaskSummaryForDate(date);
        }

        function renderActivitySummary(inputData) {
            const activities = [];
            
            if (inputData.sonic_sketch) {
                activities.push(`
                    <div class="activity-item completed">
                        <span class="activity-icon"></span>
                        <div class="activity-details">
                            <strong>Sonic Sketch</strong>
                            <p>Duration: ${inputData.sonic_sketch.duration || 'N/A'} minutes</p>
                            <p>${inputData.sonic_sketch.description || 'No description'}</p>
                        </div>
                    </div>
                `);
            }
            
            if (inputData.visual_moodboard) {
                const imageCount = Array.isArray(inputData.visual_moodboard.images) ? inputData.visual_moodboard.images.length : 0;
                activities.push(`
                    <div class="activity-item completed">
                        <span class="activity-icon"></span>
                        <div class="activity-details">
                            <strong>Visual Moodboard</strong>
                            <p>Images: ${imageCount}</p>
                            <p>${inputData.visual_moodboard.description || 'No description'}</p>
                        </div>
                    </div>
                `);
            }
            
            if (inputData.lore_fragment) {
                activities.push(`
                    <div class="activity-item completed">
                        <span class="activity-icon"></span>
                        <div class="activity-details">
                            <strong>Lore Fragment</strong>
                            <p>"${inputData.lore_fragment.content || 'No content'}"</p>
                            <p>Tags: ${(inputData.lore_fragment.tags || []).join(', ') || 'None'}</p>
                        </div>
                    </div>
                `);
            }
            
            if (activities.length === 0) {
                return '<p style="text-align: center; opacity: 0.7; padding: 20px;">No creative activities recorded for this day</p>';
            }
            
            return activities.join('');
        }

        function renderDailyStats(inputData, calendarData) {
            const completedActivities = [
                inputData.sonic_sketch ? 1 : 0,
                inputData.visual_moodboard ? 1 : 0,
                inputData.lore_fragment ? 1 : 0
            ].reduce((a, b) => a + b, 0);
            
            return `
                <div class="stat-item">
                    <span class="stat-value">${completedActivities}</span>
                    <span class="stat-label">Activities</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${Math.round(completedActivities / 3 * 100)}%</span>
                    <span class="stat-label">Completion</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${Object.keys(calendarData).length}</span>
                    <span class="stat-label">Outputs</span>
                </div>
            `;
        }

        function renderFileGallery(inputData, date) {
            const files = [];
            
            // Add images
            if (inputData.visual_moodboard && inputData.visual_moodboard.images) {
                inputData.visual_moodboard.images.forEach(image => {
                    files.push(`
                        <div class="gallery-item" onclick="openMediaModal('${image}', 'image')">
                            <img src="/api/images/${image}" alt="Visual Moodboard Image" loading="lazy">
                        </div>
                    `);
                });
            }
            
            // Add audio
            if (inputData.sonic_sketch && inputData.sonic_sketch.audio_file) {
                files.push(`
                    <div class="gallery-item" onclick="openMediaModal('${inputData.sonic_sketch.audio_file}', 'audio')">
                        <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: rgba(64, 224, 208, 0.2); color: #40e0d0; font-size: 2em;">
                            
                        </div>
                    </div>
                `);
            }
            
            if (files.length === 0) {
                return '<p style="text-align: center; opacity: 0.7; padding: 20px;">No media files for this day</p>';
            }
            
            return files.join('');
        }

        function renderTaskSummary(date) {
            return '<div id="task-loading">Loading task data...</div>';
        }

        function renderAchievements(inputData, calendarData) {
            const achievements = [];
            const completedActivities = [
                inputData.sonic_sketch,
                inputData.visual_moodboard,
                inputData.lore_fragment
            ].filter(Boolean).length;
            
            if (completedActivities === 3) {
                achievements.push(' Perfect Day - All activities completed!');
            } else if (completedActivities >= 2) {
                achievements.push(' Great Progress - Multiple activities completed');
            } else if (completedActivities >= 1) {
                achievements.push(' Getting Started - At least one activity completed');
            }
            
            if (Object.keys(calendarData).length > 0) {
                achievements.push(' Creative Output - Generated content this day');
            }
            
            if (achievements.length === 0) {
                achievements.push(' Rest Day - No major activities recorded');
            }
            
            return achievements.map(achievement => 
                `<div class="achievement-item">${achievement}</div>`
            ).join('');
        }

        function renderEmptySummary(date) {
            const summaryContent = document.getElementById('summary-content');
            summaryContent.innerHTML = `
                <div class="summary-placeholder">
                    <div class="placeholder-icon"></div>
                    <h3>No Data Available</h3>
                    <p>No activities or data recorded for ${new Date(date).toLocaleDateString()}.</p>
                    <p>This might be a rest day or data hasn't been logged yet.</p>
                </div>
            `;
        }

        function loadTaskSummaryForDate(date) {
            // This would integrate with the task system to show task completion for the date
            // For now, we'll show a placeholder
            document.getElementById('task-loading').innerHTML = 
                '<p style="text-align: center; opacity: 0.7;">Task integration coming soon...</p>';
        }

        function generateDailyReport() {
            showSuccessMessage(' Daily report generation feature coming soon!');
        }

        function exportDayData() {
            showSuccessMessage(' Data export feature coming soon!');
        }

        function openMediaModal(filename, type) {
            // Create a simple modal to view media
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); display: flex; align-items: center; 
                justify-content: center; z-index: 10000; cursor: pointer;
            `;
            
            if (type === 'image') {
                modal.innerHTML = `<img src="/api/images/${filename}" style="max-width: 90%; max-height: 90%; border-radius: 10px;">`;
            } else if (type === 'audio') {
                modal.innerHTML = `
                    <div style="background: rgba(91, 50, 124, 0.9); padding: 30px; border-radius: 15px;">
                        <h3 style="color: #40e0d0; margin-bottom: 20px; text-align: center;"> Audio File</h3>
                        <audio controls style="width: 100%;">
                            <source src="/api/audio/${filename}" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                `;
            }
            
            modal.onclick = () => modal.remove();
            document.body.appendChild(modal);
        }

        // View Management
        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('.view-content').forEach(view => {
                view.classList.remove('active');
            });
            
            // Remove active from all tabs
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected view
            document.getElementById(viewName + '-view').classList.add('active');
            
            // Set active tab
            document.querySelector(`[data-view="${viewName}"]`).classList.add('active');
            
            // Load view-specific data
            if (viewName === 'calendar') {
                loadCalendar();
            } else if (viewName === 'vst3') {
                loadVST3Plugins();
            } else if (viewName === 'tasks' && taskManager) {
                taskManager.loadTasks('weekly');
                taskManager.loadTasks('monthly');
            } else if (viewName === 'daily-summary') {
                // Load summary for today by default if no specific date is set
                const today = new Date().toISOString().split('T')[0];
                loadDailySummary(today);
            } else if (viewName === 'documents') {
                loadDocumentList();
            }
        }
        
        // Add event listeners for view tabs
        document.querySelectorAll('.view-tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                const viewName = e.target.getAttribute('data-view');
                showView(viewName);
            });
        });

        // VST3 Plugin Management
        function loadVST3Plugins() {
            fetch('/api/output/vst3')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        renderVST3List(data.plugins);
                    }
                })
                .catch(error => {
                    console.log('VST3 data not available');
                    document.getElementById('vst3-list').innerHTML = '<p>No VST3 plugins found.</p>';
                });
        }
        
        function renderVST3List(plugins) {
            const list = document.getElementById('vst3-list');
            
            let html = '';
            
            if (plugins.length === 0) {
                html += '<p>No VST3 plugins found. Start creating your weekly plugin!</p>';
            } else {
                html += plugins.map(plugin => `
                    <div class="vst3-item">
                        <div class="vst3-header">
                            <h4>${plugin.title}</h4>
                            <button class="edit-btn" onclick="editVST3Plugin('${plugin.id}')"> Edit</button>
                        </div>
                        <p>${plugin.description}</p>
                        <small>Created: ${new Date(plugin.release_date).toLocaleDateString()}</small>
                        ${plugin.tags && plugin.tags.length > 0 ? `<div class="tags">Tags: ${plugin.tags.join(', ')}</div>` : ''}
                        ${plugin.file_path ? `<div class="file-path">File: ${plugin.file_path}</div>` : ''}
                    </div>
                `).join('');
            }
            
            list.innerHTML = html;
        }
        
        function openVST3Modal(pluginId = null) {
            const modal = document.getElementById('quickLogModal');
            const form = document.getElementById('quickLogForm');
            const typeSelect = document.getElementById('outputType');
            
            // Set to VST3 type
            typeSelect.value = 'vst3';
            
            if (pluginId) {
                // Edit mode - fetch current data
                fetch(`/api/output/vst3`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const plugin = data.plugins.find(p => p.id === pluginId);
                            if (plugin) {
                                document.getElementById('outputTitle').value = plugin.title;
                                document.getElementById('outputDescription').value = plugin.description;
                                form.setAttribute('data-edit-id', pluginId);
                            }
                        }
                    });
            } else {
                // New plugin mode
                form.removeAttribute('data-edit-id');
                form.reset();
                typeSelect.value = 'vst3';
            }
            
            modal.style.display = 'block';
        }
        
        function editVST3Plugin(pluginId) {
            openVST3Modal(pluginId);
        }
        
        // Handle output type change to show/hide category field
        function handleOutputTypeChange() {
            const typeSelect = document.getElementById('outputType');
            const categoryGroup = document.getElementById('categoryGroup');
            
            if (typeSelect.value === 'vst3') {
                categoryGroup.style.display = 'none';
            } else {
                categoryGroup.style.display = 'block';
            }
        }

        // Handle quick log modal form submission
        document.addEventListener('DOMContentLoaded', function() {
            // Set up output type change handler
            const typeSelect = document.getElementById('outputType');
            if (typeSelect) {
                typeSelect.addEventListener('change', handleOutputTypeChange);
                handleOutputTypeChange(); // Initialize
            }
            const quickLogForm = document.getElementById('quickLogForm');
            if (quickLogForm) {
                quickLogForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(e.target);
                    const type = formData.get('type');
                    const title = formData.get('title');
                    const description = formData.get('description') || '';
                    const editId = e.target.getAttribute('data-edit-id');
                    
                    let endpoint = '/api/output/' + type;
                    let method = 'POST';
                    let data = { title, description };
                    
                    if (editId) {
                        endpoint += '/' + editId;
                        method = 'PUT';
                    }
                    
                    if (type !== 'vst3') {
                        data.category = formData.get('category');
                    }
                    
                    fetch(endpoint, {
                        method: method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            showSuccessMessage(editId ? 'Updated successfully!' : 'Created successfully!');
                            document.getElementById('quickLogModal').style.display = 'none';
                            e.target.reset();
                            e.target.removeAttribute('data-edit-id');
                            
                            // Refresh current view
                            const activeView = document.querySelector('.view-tab.active').getAttribute('data-view');
                            if (activeView === 'vst3') {
                                loadVST3Plugins();
                            } else {
                                updateDashboard();
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Error saving. Please try again.');
                    });
                });
            }
        });

        // Fasting Tracker System
        class FastingTracker {
            constructor() {
                this.latitude = 40.7128; // Default to NYC coordinates
                this.longitude = -74.0060;
                this.fastingTimer = null;
                this.init();
            }

            init() {
                // Try to get user's location for accurate sunrise/sunset
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        this.latitude = position.coords.latitude;
                        this.longitude = position.coords.longitude;
                        this.updateFastingData();
                    }, () => {
                        // Fallback to default location
                        this.updateFastingData();
                    });
                } else {
                    this.updateFastingData();
                }

                // Start real-time updates
                this.startTimer();
            }

            calculateSunTimes(date) {
                // Simplified sunrise/sunset calculation
                const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
                const lat = this.latitude * Math.PI / 180;
                
                // Solar declination
                const declination = Math.asin(Math.sin(23.45 * Math.PI / 180) * Math.sin((360 * (284 + dayOfYear) / 365) * Math.PI / 180));
                
                // Hour angle
                const hourAngle = Math.acos(-Math.tan(lat) * Math.tan(declination));
                
                // Convert to hours
                const sunriseHour = 12 - (hourAngle * 12 / Math.PI);
                const sunsetHour = 12 + (hourAngle * 12 / Math.PI);
                
                // Create time objects
                const sunrise = new Date(date);
                sunrise.setHours(Math.floor(sunriseHour), (sunriseHour % 1) * 60, 0, 0);
                
                const sunset = new Date(date);
                sunset.setHours(Math.floor(sunsetHour), (sunsetHour % 1) * 60, 0, 0);
                
                return { sunrise, sunset };
            }

            getFastingSchedule(date) {
                const { sunrise, sunset } = this.calculateSunTimes(date);
                
                // Fasting starts at sunset, lasts 16 hours
                const fastStart = new Date(sunset);
                const fastEnd = new Date(sunset.getTime() + (16 * 60 * 60 * 1000));
                
                // Eating window is the remaining 8 hours
                const eatStart = new Date(fastEnd);
                const eatEnd = new Date(fastStart);
                
                return {
                    sunrise,
                    sunset,
                    fastStart,
                    fastEnd,
                    eatStart,
                    eatEnd
                };
            }

            formatTime(date) {
                return date.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
            }

            formatDuration(milliseconds) {
                const hours = Math.floor(milliseconds / (1000 * 60 * 60));
                const minutes = Math.floor((milliseconds % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((milliseconds % (1000 * 60)) / 1000);
                
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            updateFastingData() {
                const now = new Date();
                const schedule = this.getFastingSchedule(now);
                
                // Update sun times
                document.getElementById('sunrise-time').textContent = this.formatTime(schedule.sunrise);
                document.getElementById('sunset-time').textContent = this.formatTime(schedule.sunset);
                
                // Update fasting schedule
                document.getElementById('fast-start').textContent = this.formatTime(schedule.fastStart);
                document.getElementById('fast-end').textContent = this.formatTime(schedule.fastEnd);
                document.getElementById('eat-start').textContent = this.formatTime(schedule.eatStart);
                document.getElementById('eat-end').textContent = this.formatTime(schedule.eatEnd);
                
                this.updateProgress(now, schedule);
            }

            updateProgress(now, schedule) {
                const currentTime = now.getTime();
                const fastStartTime = schedule.fastStart.getTime();
                const fastEndTime = schedule.fastEnd.getTime();
                
                const statusBadge = document.getElementById('current-status');
                const currentDuration = document.getElementById('current-duration');
                const timeRemaining = document.getElementById('time-remaining');
                const progressFill = document.getElementById('progress-fill');
                const progressText = document.getElementById('progress-percentage');
                
                let isFasting = false;
                let currentMs = 0;
                let remainingMs = 0;
                let progressPercent = 0;
                
                // Check if we're currently fasting
                if (currentTime >= fastStartTime && currentTime <= fastEndTime) {
                    // Currently fasting
                    isFasting = true;
                    currentMs = currentTime - fastStartTime;
                    remainingMs = fastEndTime - currentTime;
                    progressPercent = (currentMs / (16 * 60 * 60 * 1000)) * 100;
                    
                    statusBadge.textContent = ' Fasting';
                    statusBadge.className = 'status-badge fasting';
                } else {
                    // Currently in eating window
                    isFasting = false;
                    
                    // Calculate time until next fast
                    let nextFastStart;
                    if (currentTime < fastStartTime) {
                        nextFastStart = fastStartTime;
                    } else {
                        // Next fast is tomorrow
                        const tomorrow = new Date(now);
                        tomorrow.setDate(tomorrow.getDate() + 1);
                        const tomorrowSchedule = this.getFastingSchedule(tomorrow);
                        nextFastStart = tomorrowSchedule.fastStart.getTime();
                    }
                    
                    currentMs = 0;
                    remainingMs = nextFastStart - currentTime;
                    progressPercent = 0;
                    
                    statusBadge.textContent = ' Eating Window';
                    statusBadge.className = 'status-badge eating';
                }
                
                // Update display
                currentDuration.textContent = this.formatDuration(Math.max(0, currentMs));
                timeRemaining.textContent = this.formatDuration(Math.max(0, remainingMs));
                progressFill.style.width = Math.min(100, progressPercent) + '%';
                progressText.textContent = Math.floor(progressPercent) + '%';
                
                // Update benefits based on fasting duration
                this.updateBenefits(currentMs, isFasting);
            }

            updateBenefits(fastingMs, isFasting) {
                if (!isFasting) {
                    document.getElementById('clarity-level').textContent = 'Baseline';
                    document.getElementById('energy-level').textContent = 'Stable';
                    document.getElementById('focus-level').textContent = 'Normal';
                    return;
                }
                
                const fastingHours = fastingMs / (1000 * 60 * 60);
                
                let clarity = 'Building';
                let energy = 'Transitioning';
                let focus = 'Improving';
                
                if (fastingHours >= 12) {
                    clarity = 'High';
                    energy = 'Stable';
                    focus = 'Enhanced';
                } else if (fastingHours >= 8) {
                    clarity = 'Good';
                    energy = 'Stabilizing';
                    focus = 'Good';
                } else if (fastingHours >= 4) {
                    clarity = 'Moderate';
                    energy = 'Adjusting';
                    focus = 'Fair';
                }
                
                document.getElementById('clarity-level').textContent = clarity;
                document.getElementById('energy-level').textContent = energy;
                document.getElementById('focus-level').textContent = focus;
            }

            startTimer() {
                // Update every second
                this.fastingTimer = setInterval(() => {
                    this.updateFastingData();
                }, 1000);
            }

            stopTimer() {
                if (this.fastingTimer) {
                    clearInterval(this.fastingTimer);
                    this.fastingTimer = null;
                }
            }
        }

        // Payment Management System
        class PaymentManager {
            constructor() {
                this.payments = [];
                this.currentEditPayment = null;
                this.categories = {
                    'creative': ' Creative Tools',
                    'services': ' Online Services', 
                    'lifestyle': ' Lifestyle',
                    'business': ' Business',
                    'other': ' Other'
                };
                this.init();
            }

            init() {
                this.loadPayments();
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('paymentForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.savePayment();
                });
            }

            async loadPayments() {
                try {
                    const response = await fetch('/api/payments');
                    const data = await response.json();
                    
                    if (data.success) {
                        this.payments = data.payments;
                        this.renderPayments();
                    }
                } catch (error) {
                    console.error('Error loading payments:', error);
                    // Load default payments if API fails
                    this.loadDefaultPayments();
                }
            }

            loadDefaultPayments() {
                this.payments = [
                    { id: '1', name: 'Ableton Live Suite', amount: 20, category: 'creative', notes: '' },
                    { id: '2', name: 'Plugin Subscriptions', amount: 30, category: 'creative', notes: '' },
                    { id: '3', name: 'Sample Libraries', amount: 15, category: 'creative', notes: '' },
                    { id: '4', name: 'Cloud Storage', amount: 10, category: 'services', notes: '' },
                    { id: '5', name: 'Streaming Platforms', amount: 25, category: 'services', notes: '' },
                    { id: '6', name: 'Domain & Hosting', amount: 12, category: 'services', notes: '' },
                    { id: '7', name: 'Gym Membership', amount: 50, category: 'lifestyle', notes: '' },
                    { id: '8', name: 'Supplements', amount: 40, category: 'lifestyle', notes: '' }
                ];
                this.renderPayments();
            }

            renderPayments() {
                const container = document.getElementById('payment-categories');
                const paymentsByCategory = {};
                
                // Group payments by category
                this.payments.forEach(payment => {
                    if (!paymentsByCategory[payment.category]) {
                        paymentsByCategory[payment.category] = [];
                    }
                    paymentsByCategory[payment.category].push(payment);
                });

                // Render each category
                let html = '';
                Object.keys(paymentsByCategory).forEach(categoryKey => {
                    const categoryName = this.categories[categoryKey] || ' Other';
                    const payments = paymentsByCategory[categoryKey];
                    
                    html += `
                        <div class="category-section">
                            <h4>${categoryName}</h4>
                            <div class="payment-items">
                                ${payments.map(payment => `
                                    <div class="payment-item">
                                        <div class="payment-item-content">
                                            <span>${payment.name}</span>
                                            <span class="amount">$${payment.amount}/month</span>
                                        </div>
                                        <div class="payment-item-actions">
                                            <button class="payment-edit-btn" onclick="paymentManager.editPayment('${payment.id}')" title="Edit"></button>
                                            <button class="payment-delete-btn" onclick="paymentManager.deletePayment('${payment.id}')" title="Delete"></button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
                this.updateTotal();
            }

            updateTotal() {
                const total = this.payments.reduce((sum, payment) => sum + parseFloat(payment.amount), 0);
                document.getElementById('payment-total').textContent = ` Monthly Total: $${total.toFixed(2)}`;
            }

            editPayment(paymentId) {
                const payment = this.payments.find(p => p.id === paymentId);
                if (!payment) return;

                this.currentEditPayment = paymentId;
                document.getElementById('paymentModalTitle').textContent = 'Edit Payment';
                document.getElementById('paymentName').value = payment.name;
                document.getElementById('paymentAmount').value = payment.amount;
                document.getElementById('paymentCategory').value = payment.category;
                document.getElementById('paymentNotes').value = payment.notes || '';
                document.getElementById('paymentModal').style.display = 'block';
                document.getElementById('paymentName').focus();
            }

            async savePayment() {
                const form = document.getElementById('paymentForm');
                const formData = new FormData(form);
                
                const paymentData = {
                    name: formData.get('name'),
                    amount: parseFloat(formData.get('amount')),
                    category: formData.get('category'),
                    notes: formData.get('notes') || ''
                };

                try {
                    let response;
                    if (this.currentEditPayment) {
                        // Update existing payment
                        response = await fetch(`/api/payments/${this.currentEditPayment}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(paymentData)
                        });
                    } else {
                        // Add new payment
                        response = await fetch('/api/payments', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(paymentData)
                        });
                    }

                    const result = await response.json();
                    if (result.success) {
                        this.loadPayments(); // Reload to get updated data
                        document.getElementById('paymentModal').style.display = 'none';
                        form.reset();
                        this.currentEditPayment = null;
                        document.getElementById('paymentModalTitle').textContent = 'Add Payment';
                        showSuccessMessage(' Payment saved successfully!');
                    } else {
                        alert('Error saving payment: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error saving payment:', error);
                    alert('Error saving payment. Please try again.');
                }
            }

            async deletePayment(paymentId) {
                if (!confirm('Are you sure you want to delete this payment?')) return;

                try {
                    const response = await fetch(`/api/payments/${paymentId}`, {
                        method: 'DELETE'
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.loadPayments(); // Reload to get updated data
                        showSuccessMessage(' Payment deleted successfully!');
                    } else {
                        alert('Error deleting payment: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error deleting payment:', error);
                    alert('Error deleting payment. Please try again.');
                }
            }
        }

        function showAddPaymentModal() {
            document.getElementById('paymentModalTitle').textContent = 'Add Payment';
            document.getElementById('paymentForm').reset();
            paymentManager.currentEditPayment = null;
            document.getElementById('paymentModal').style.display = 'block';
            document.getElementById('paymentName').focus();
        }

        // Motivational Quote Functions
        async function getNewQuote() {
            try {
                const button = document.querySelector('button[onclick="getNewQuote()"]');
                const originalText = button.textContent;
                button.textContent = ' Loading...';
                button.disabled = true;

                const response = await fetch('/api/quote');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('motivational-quote').textContent = `"${data.quote}"`;
                    document.getElementById('quote-author').textContent = ` ${data.author}`;
                    showSuccessMessage(' New inspiration loaded!');
                } else {
                    showSuccessMessage(' Could not load new quote');
                }
            } catch (error) {
                console.error('Error fetching quote:', error);
                showSuccessMessage(' Could not load new quote');
            } finally {
                const button = document.querySelector('button[onclick="getNewQuote()"]');
                button.textContent = ' New Quote';
                button.disabled = false;
            }
        }

        // Load initial quote on page load
        function loadInitialQuote() {
            // Load a quote automatically when the page loads
            getNewQuote();
        }

        // Task Management System
        class TaskManager {
            constructor() {
                this.currentTaskType = null;
                this.currentEditTask = null;
                this.init();
            }

            init() {
                this.loadTasks('weekly');
                this.loadTasks('monthly');
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Add task form
                document.getElementById('addTaskForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addTask();
                });

                // Edit task form
                document.getElementById('editTaskForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveEditTask();
                });
            }

            async loadTasks(taskType) {
                try {
                    const response = await fetch(`/api/tasks/${taskType}`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.renderTasks(taskType, data.tasks);
                        this.updateProgress(taskType, data.tasks);
                    }
                } catch (error) {
                    console.error(`Error loading ${taskType} tasks:`, error);
                    document.getElementById(`${taskType}-tasks`).innerHTML = 
                        `<div class="loading-tasks">Error loading tasks</div>`;
                }
            }

            renderTasks(taskType, tasks) {
                const container = document.getElementById(`${taskType}-tasks`);
                
                if (tasks.length === 0) {
                    container.innerHTML = `<div class="loading-tasks">No ${taskType} tasks yet. Add some!</div>`;
                    return;
                }

                container.innerHTML = tasks.map(task => `
                    <div class="task-item ${task.priority}-priority">
                        <input type="checkbox" class="task-checkbox" 
                               ${task.completed ? 'checked' : ''} 
                               onchange="taskManager.toggleTask('${taskType}', '${task.id}', this.checked)">
                        <span class="task-text ${task.completed ? 'completed' : ''}">${task.text}</span>
                        <span class="task-priority ${task.priority}">${this.getPriorityIcon(task.priority)}</span>
                        <div class="task-actions">
                            <button class="task-edit-btn" onclick="taskManager.editTask('${taskType}', '${task.id}', '${task.text.replace(/'/g, "\\'")}', '${task.priority}')" title="Edit"></button>
                            <button class="task-delete-btn" onclick="taskManager.deleteTask('${taskType}', '${task.id}')" title="Delete"></button>
                        </div>
                    </div>
                `).join('');
            }

            getPriorityIcon(priority) {
                switch (priority) {
                    case 'high': return '';
                    case 'medium': return '';
                    case 'low': return '';
                    default: return '';
                }
            }

            updateProgress(taskType, tasks) {
                const completed = tasks.filter(task => task.completed).length;
                const total = tasks.length;
                const percentage = total === 0 ? 0 : Math.round((completed / total) * 100);

                document.getElementById(`${taskType}-completed`).textContent = completed;
                document.getElementById(`${taskType}-total`).textContent = total;
                document.getElementById(`${taskType}-progress-fill`).style.width = percentage + '%';
                document.getElementById(`${taskType}-progress-text`).textContent = percentage + '%';
            }

            async toggleTask(taskType, taskId, completed) {
                try {
                    const response = await fetch(`/api/tasks/${taskType}/${taskId}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ completed })
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.loadTasks(taskType);
                    }
                } catch (error) {
                    console.error('Error toggling task:', error);
                }
            }

            showAddTaskModal(taskType) {
                this.currentTaskType = taskType;
                document.getElementById('add-task-title').textContent = `Add New ${taskType.charAt(0).toUpperCase() + taskType.slice(1)} Task`;
                document.getElementById('addTaskModal').style.display = 'block';
                document.getElementById('taskText').focus();
            }

            async addTask() {
                const form = document.getElementById('addTaskForm');
                const formData = new FormData(form);
                
                const taskData = {
                    text: formData.get('text'),
                    priority: formData.get('priority')
                };

                try {
                    const response = await fetch(`/api/tasks/${this.currentTaskType}`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(taskData)
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.loadTasks(this.currentTaskType);
                        document.getElementById('addTaskModal').style.display = 'none';
                        form.reset();
                    }
                } catch (error) {
                    console.error('Error adding task:', error);
                }
            }

            editTask(taskType, taskId, text, priority) {
                this.currentTaskType = taskType;
                this.currentEditTask = taskId;
                
                document.getElementById('editTaskText').value = text;
                document.getElementById('editTaskPriority').value = priority;
                document.getElementById('editTaskModal').style.display = 'block';
                document.getElementById('editTaskText').focus();
            }

            async saveEditTask() {
                const form = document.getElementById('editTaskForm');
                const formData = new FormData(form);
                
                const updates = {
                    text: formData.get('text'),
                    priority: formData.get('priority')
                };

                try {
                    const response = await fetch(`/api/tasks/${this.currentTaskType}/${this.currentEditTask}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(updates)
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.loadTasks(this.currentTaskType);
                        document.getElementById('editTaskModal').style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error updating task:', error);
                }
            }

            async deleteTask(taskType, taskId) {
                if (!confirm('Are you sure you want to delete this task?')) {
                    return;
                }

                try {
                    const response = await fetch(`/api/tasks/${taskType}/${taskId}`, {
                        method: 'DELETE'
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.loadTasks(taskType);
                    }
                } catch (error) {
                    console.error('Error deleting task:', error);
                }
            }
        }

        // Global functions for onclick handlers
        function showAddTaskModal(taskType) {
            taskManager.showAddTaskModal(taskType);
        }

        function openImagesFolder() {
            // This function will open the images folder in the OS file explorer
            // Note: This requires a backend API call for security reasons
            showSuccessMessage(' Opening images folder... (Feature requires backend implementation)');
        }

        // Initialize task manager and fasting tracker when page loads
        let taskManager;
        let paymentManager;
        let fastingTracker;
        document.addEventListener('DOMContentLoaded', function() {
            taskManager = new TaskManager();
            paymentManager = new PaymentManager();
            fastingTracker = new FastingTracker();
            loadTasksData();
            loadPaymentsData();
            loadInitialQuote();
            initializeDateNavigation();
        });

        // Clean up timer when page unloads
        window.addEventListener('beforeunload', function() {
            if (fastingTracker) {
                fastingTracker.stopTimer();
            }
        });
    </script>

    <!-- Quick Log Modal -->
    <div id="quickLogModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('quickLogModal').style.display='none'">&times;</span>
            <h2>Quick Log Output</h2>
            <form id="quickLogForm">
                <div class="form-group">
                    <label for="outputType">Type:</label>
                    <select id="outputType" name="type" required>
                        <option value="micro">Micro Release</option>
                        <option value="major">Major Release</option>
                        <option value="vst3">VST3 Plugin</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="outputTitle">Title:</label>
                    <input type="text" id="outputTitle" name="title" required>
                </div>
                
                <div class="form-group" id="categoryGroup">
                    <label for="outputCategory">Category:</label>
                    <select id="outputCategory" name="category">
                        <option value="beat">Beat</option>
                        <option value="visual">Visual</option>
                        <option value="lore">Lore</option>
                        <option value="track">Track</option>
                        <option value="video">Video</option>
                        <option value="plugin">Plugin</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="outputDescription">Description:</label>
                    <textarea id="outputDescription" name="description" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" onclick="document.getElementById('quickLogModal').style.display='none'">Cancel</button>
                    <button type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>